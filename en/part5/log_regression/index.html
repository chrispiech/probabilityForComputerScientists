<!DOCTYPE html>
<html>

<head>


<title>Logistic Regression</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="content-type" content="text/html; charset=UTF8">

<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
 <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />

<!-- D3 CDN -->
<script src="https://d3js.org/d3.v3.js"></script>
<!-- <script src="https://d3js.org/d3.v4.js"></script> -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- Chart CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js" integrity="sha512-FuXN8O36qmtA+vRJyRoAxPcThh/1KJJp7WSRnjCpqA+13HYGrSWiyzrCHalCWi42L5qH1jt88lX5wy5JyFxhfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- PDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js" integrity="sha512-Z8CqofpIcnJN80feS2uccz+pXWgZzeKxDsDNMD/dJ6997/LSRY+W4NmEt9acwR+Gt9OHN0kkI1CTianCwoqcjQ==" crossorigin="anonymous"></script>

<!-- Lunr CDN -->
 <script src="https://unpkg.com/lunr@2.0.4/lunr.js"></script>

<!-- Firebase CDN -->
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="../../../css/style.css">

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>


   

<!-- Java Script -->
<script src="../../../plugins/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- Probability Packages -->
<script src="../../../js/probabilityUtils.js"></script>
<script src="../../../plugins/probability/gaussian.js"></script>
<script src="../../../plugins/color.js"></script>
<script src='https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js'></script>


<!-- font awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<!-- SWAL -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<!-- Stanford -->
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,600,700' rel='stylesheet' type='text/css'>
<link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">

<!-- Math Jax -->
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script> -->
<script type="text/javascript">
  MathJax = {
    config: ["MMLorHTML.js"],
    jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
    extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js"],
    TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js", "action.js"]
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
	"fast-preview": {
	  disabled: true
	}
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>



<script src="../../../plugins/math.min.js"></script>



    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

 <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="../../../plugins/jquery.mCustomScrollbar.js"></script>

</head>

<script>
  Chart.defaults.font.family = 'Times New Roman';
  Chart.defaults.font.size = 18;
</script>


<!-- I declare a few math operators I often use in equations -->
<div style="display:none">
  $\DeclareMathOperator{\p}{P}$
  $\DeclareMathOperator{\P}{P}$
  $\DeclareMathOperator{\c}{^C}$
  $\DeclareMathOperator{\or}{ or}$
  $\DeclareMathOperator{\and}{ and}$
  $\DeclareMathOperator{\var}{Var}$
  $\DeclareMathOperator{\Var}{Var}$
  $\DeclareMathOperator{\Std}{Std}$
  $\DeclareMathOperator{\E}{E}$
  $\DeclareMathOperator{\std}{Std}$
  $\DeclareMathOperator{\Ber}{Bern}$
  $\DeclareMathOperator{\Bin}{Bin}$
  $\DeclareMathOperator{\Poi}{Poi}$
  $\DeclareMathOperator{\Uni}{Uni}$
  $\DeclareMathOperator{\Geo}{Geo}$
  $\DeclareMathOperator{\NegBin}{NegBin}$
  $\DeclareMathOperator{\Beta}{Beta}$
  $\DeclareMathOperator{\Exp}{Exp}$
  $\DeclareMathOperator{\N}{N}$
  $\DeclareMathOperator{\R}{\mathbb{R}}$
  $\DeclareMathOperator*{\argmax}{arg\,max}$
  $\newcommand{\d}{\, d}$

</div>




<body class="greyBackground">

<nav id="sidebar">
    <div class="sidebar-header">
        <!-- <div></div> -->
        <a style="text-align:left" href="../../index.html"><h3></i> Probability<br/>For Computer Science<br/></h3></a>
    </div>

    <div> 
        <!-- Put a link back to cs109 -->
    

        <!-- This adds a search bar! -->
        <div class="searchCol" style="font-family: 'Source Sans Pro', sans-serif;">
            
            <input type="text" class="form-control bookSearch" id="probability-for-digital-world-search" aria-describedby="search box" placeholder="🔍 Search book..."/>
        </div>
        
    </div>

<!-- intro -->
<ul class="list-unstyled components">
<li>
<a id=sidebar-notation href="../../intro/notation">Notation Reference</a>
<a id=sidebar-core_probability_ref href="../../intro/core_probability_ref">Core Probability Reference</a>
<a id=sidebar-all_distributions href="../../intro/all_distributions">Random Variable Reference</a>
<a id=sidebar-python href="../../intro/python">Python Reference</a>
<a id=sidebar-calculators href="../../intro/calculators">Calculators</a>
</li>
</ul>

<!-- part1 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part1">Part 1: Core Probability</p></li>
<li>
<a id=sidebar-counting href="../../part1/counting">Counting</a>
<a id=sidebar-combinatorics href="../../part1/combinatorics">Combinatorics</a>
<a id=sidebar-probability href="../../part1/probability">Definition of Probability</a>
<a id=sidebar-equally_likely href="../../part1/equally_likely">Equally Likely Outcomes</a>
<a id=sidebar-prob_or href="../../part1/prob_or">Probability of <b>or</b></a>
<a id=sidebar-cond_prob href="../../part1/cond_prob">Conditional Probability</a>
<a id=sidebar-independence href="../../part1/independence">Independence</a>
<a id=sidebar-prob_and href="../../part1/prob_and">Probability of <b>and</b></a>
<a id=sidebar-law_total href="../../part1/law_total">Law of Total Probability</a>
<a id=sidebar-bayes_theorem href="../../part1/bayes_theorem">Bayes' Theorem</a>
<a id=sidebar-log_probabilities href="../../part1/log_probabilities">Log Probabilities</a>
<a id=sidebar-many_flips href="../../part1/many_flips">Many Coin Flips</a>

<li>
    <a href="#part1_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part1_examples">
        <li><a href="../../examples/enigma">Enigma Machine</a></li><li><a href="../../examples/serendipity">Serendipity</a></li><li><a href="../../examples/random_shuffles">Random Shuffles</a></li><li><a href="../../examples/counting_graphs">Random Graphs</a></li><li><a href="../../examples/diversity_shapes">Set Diversity</a></li><li><a href="../../examples/bacteria_evolution">Bacteria Evolution</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part2 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part2">Part 2: Random Variables</p></li>
<li>
<a id=sidebar-rvs href="../../part2/rvs">Random Variables</a>
<a id=sidebar-pmf href="../../part2/pmf">Probability Mass Functions</a>
<a id=sidebar-expectation href="../../part2/expectation">Expectation</a>
<a id=sidebar-variance href="../../part2/variance">Variance</a>
<a id=sidebar-bernoulli href="../../part2/bernoulli">Bernoulli Distribution</a>
<a id=sidebar-binomial href="../../part2/binomial">Binomial Distribution</a>
<a id=sidebar-poisson href="../../part2/poisson">Poisson Distribution</a>
<a id=sidebar-more_discrete href="../../part2/more_discrete">More Discrete Distributions</a>
<a id=sidebar-categorical href="../../part2/categorical">Categorical Distributions</a>
<a id=sidebar-continuous href="../../part2/continuous">Continuous Distribution</a>
<a id=sidebar-uniform href="../../part2/uniform">Uniform Distribution</a>
<a id=sidebar-exponential href="../../part2/exponential">Exponential Distribution</a>
<a id=sidebar-normal href="../../part2/normal">Normal Distribution</a>
<a id=sidebar-binomial_approx href="../../part2/binomial_approx">Binomial Approximation</a>

<li>
    <a href="#part2_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part2_examples">
        <li><a href="../../examples/100_binomial_problems">100 Binomial Problems</a></li><li><a href="../../examples/winning_series">Winning Series</a></li><li><a href="../../examples/approximate_counting">Approximate Counting</a></li><li><a href="../../examples/jury">Jury Selection</a></li><li><a href="../../examples/grading_eye_inflammation">Grading Eye Inflamation</a></li><li><a href="../../examples/grades_not_normal">Grades are Not Normal</a></li><li><a href="../../examples/curse_of_dimensionality">Curse of Dimensionality</a></li><li><a href="../../examples/algorithmic_art">Algorithmic Art</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part3 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part3">Part 3: Probabilistic Models</p></li>
<li>
<a id=sidebar-joint href="../../part3/joint">Joint Probability</a>
<a id=sidebar-marginalization href="../../part3/marginalization">Marginalization</a>
<a id=sidebar-multinomial href="../../part3/multinomial">Multinomial</a>
<a id=sidebar-continuous_joint href="../../part3/continuous_joint">Continuous Joint</a>
<a id=sidebar-inference href="../../part3/inference">Inference</a>
<a id=sidebar-bayesian_networks href="../../part3/bayesian_networks">Bayesian Networks</a>
<a id=sidebar-independent_vars href="../../part3/independent_vars">Independence in Variables</a>
<a id=sidebar-correlation href="../../part3/correlation">Correlation</a>
<a id=sidebar-computational_inference href="../../part3/computational_inference">General Inference</a>

<li>
    <a href="#part3_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part3_examples">
        <li><a href="../../examples/fairness">Fairness in AI</a></li><li><a href="../../examples/federalist">Federalist Paper Authorship</a></li><li><a href="../../examples/name2age">Name to Age</a></li><li><a href="../../examples/prob_baby_delivery">Probability of Baby Delivery</a></li><li><a href="../../examples/bayesian_carbon_dating">Bayesian Carbon Dating</a></li><li><a href="../../examples/digital_vision_test">Digital Vision Test</a></li><li><a href="../../examples/bridge_distribution">Bridge Distribution</a></li><li><a href="../../examples/expectation_of_sums">Expectation of Sum Proof</a></li><li><a href="../../examples/bayesian_viral_load_test">Bayesian Viral Load Test</a></li><li><a href="../../examples/dart_logo">CS109 Logo</a></li><li><a href="../../examples/tracking_in_2D">Tracking in 2D</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part4 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part4">Part 4: Uncertainty Theory</p></li>
<li>
<a id=sidebar-beta href="../../part4/beta">Beta Distribution</a>
<a id=sidebar-summation_vars href="../../part4/summation_vars">Adding Random Variables</a>
<a id=sidebar-clt href="../../part4/clt">Central Limit Theorem</a>
<a id=sidebar-samples href="../../part4/samples">Sampling</a>
<a id=sidebar-bootstrapping href="../../part4/bootstrapping">Bootstrapping</a>
<a id=sidebar-algorithmic_analysis href="../../part4/algorithmic_analysis">Algorithmic Analysis</a>
<a id=sidebar-information_theory href="../../part4/information_theory">Information Theory</a>
<a id=sidebar-divergence href="../../part4/divergence">Distance Between Distributions</a>

<li>
    <a href="#part4_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part4_examples">
        <li><a href="../../examples/thompson">Thompson Sampling</a></li><li><a href="../../examples/night_sight">Night Sight</a></li><li><a href="../../examples/p_hacking">P-Hacking</a></li><li><a href="../../examples/differential_privacy">Differential Privacy</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part5 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part5">Part 5: Machine Learning</p></li>
<li>
<a id=sidebar-parameter_estimation href="../../part5/parameter_estimation">Parameter Estimation</a>
<a id=sidebar-mle href="../../part5/mle">Maximum Likelihood Estimation</a>
<a id=sidebar-map href="../../part5/map">Maximum A Posteriori</a>
<a id=sidebar-machine_learning href="../../part5/machine_learning">Machine Learning</a>
<a id=sidebar-naive_bayes href="../../part5/naive_bayes">Naïve Bayes</a>
<a id=sidebar-log_regression href="../../part5/log_regression">Logistic Regression</a>

<li>
    <a href="#part5_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part5_examples">
        <li><a href="../../examples/mle_demo">MLE Normal Demo</a></li><li><a href="../../examples/mle_pareto">MLE Pareto Distribution</a></li><li><a href="../../examples/mixture_models">MLE Mixture Model</a></li>
    </ul>
</li>
</li>
</ul>


    <ul class="list-unstyled CTAs">
        <li>
            Ⓒ Chris Piech, Stanford University
        </li>
    </ul>
</nav>

  <div class="wrapper">


    <!-- Page Content  -->
    <div id="content">

<button type="button" id="sidebarCollapse" class="mobile-only btn btn-dark exclude-from-print">
    <i class="fas fa-align-left"></i>
    <span></span>
</button>
      <div class="container-fluid">
        <div class="row d-flex justify-content-center">
          <div class="col handout">

            
 
<center><h1>Logistic Regression</h1></center>
<hr/>


<p>Logistic Regression is a classification algorithm (I know, terrible name. Perhaps Logistic Classification would have been better) that works by trying to learn a function that approximates $\P(y|x)$. It makes the central assumption that $\P(y|x)$ can be approximated as a sigmoid function applied to a linear combination of input features. It is particularly important to learn because logistic regression is the basic building block of artificial neural networks.

<p>Mathematically, for a single training datapoint ($\mathbf{x}, y)$ Logistic Regression assumes:
\begin{align*}
P(Y=1|\mathbf{X}=\mathbf{x}) &= \sigma(z) \text{ where } z = \theta_0 + \sum_{i=1}^m \theta_i x_i
\end{align*}
This assumption is often written in the equivalent forms:
\begin{align*}
    P(Y=1|\mathbf{X}=\mathbf{x}) &=\sigma(\mathbf{\theta}^T\mathbf{x}) &&\text{ where we always set $x_0$ to be 1}\\
    P(Y=0|\mathbf{X}=\mathbf{x}) &=1-\sigma(\mathbf{\theta}^T\mathbf{x}) &&\text{ by total law of probability}
\end{align*}
Using these equations for probability of $Y|X$ we can create an algorithm that selects values of theta that maximize that probability for all data. I am first going to state the log probability function and partial derivatives with respect to theta. Then later we will (a) show an algorithm that can chose optimal values of theta and (b) show how the equations were derived.

<p>An important thing to realize is that: given the best values for the parameters ($\theta$), logistic regression often can do a great job of estimating the probability of different class labels. However, given bad , or even random, values of $\theta$ it does a poor job. The amount of ``intelligence" that you logistic regression machine learning algorithm has is dependent on having good values of $\theta$.

<h2>Notation</h2>
<p>Before we get started I want to make sure that we are all on the same page with respect to notation. In logistic regression, $\theta$ is a vector of parameters of length $m$ and we are going to learn the values of those parameters based off of $n$ training examples. The number of parameters should be equal to the number of features of each datapoint. 

<p>Two pieces of notation that we use often in logistic regression that you may not be familiar with are:
\begin{align*}
    \mathbf{\theta}^T\mathbf{x} &= \sum_{i=1}^m \theta_i x_i = \theta_1 x_1 + \theta_2 x_2 + \dots + \theta_m x_m && \text{dot product, aka weighted sum}\\
    \sigma(z) &= \frac{1}{1+ e^{-z}}  && \text{sigmoid function}
\end{align*}

<h2>Log Likelihood</h2>
<p>In order to chose values for the parameters of logistic regression we use Maximum Likelihood Estimation (MLE). As such we are going to have two steps: (1) write the log-likelihood function and (2) find the values of $\theta$ that maximize the log-likelihood function.

<p>The labels that we are predicting are binary, and the output of our logistic regression function is supposed to be the probability that the label is one. This means that we can (and should) interpret the each label as a Bernoulli random variable: $Y \sim \text{Bern}(p)$ where $p = \sigma(\theta^T \textbf{x})$.

<p>To start, here is a super slick way of writing the probability of one datapoint (recall this is the equation form of the probability mass function of a Bernoulli):
\begin{align*}
 P(Y=y | X = \mathbf{x}) = \sigma({\mathbf{\theta}^T\mathbf{x}})^y \cdot \left[1 - \sigma({\mathbf{\theta}^T\mathbf{x}})\right]^{(1-y)}
 \end{align*}
 
<p>Now that we know the probability mass function, we can write the likelihood of all the data: 
  \begin{align*}
L(\theta) =& \prod_{i=1}^n P(Y=y^{(i)} | X = \mathbf{x}^{(i)}) && \text{The likelihood of independent training labels}\\
=& \prod_{i=1}^n \sigma({\mathbf{\theta}^T\mathbf{x}^{(i)}})^{y^{(i)}} \cdot \left[1 - \sigma({\mathbf{\theta}^T\mathbf{x}^{(i)}})\right]^{(1-y^{(i)})} && \text{Substituting the likelihood of a Bernoulli}
 \end{align*}
 And if you take the log of this function, you get the reported Log Likelihood for Logistic Regression. The log likelihood equation is:
\begin{align*}
    LL(\theta) = \sum_{i=1}^n y^{(i)} \log \sigma(\mathbf{\theta}^T\mathbf{x}^{(i)}) + (1-y^{(i)}) \log [1 - \sigma(\mathbf{\theta}^T\mathbf{x}^{(i)})]
\end{align*}

<p>Recall that in MLE the only remaining step is to chose parameters ($\theta$) that maximize log likelihood.

<h2>Gradient of Log Likelihood</h2>
Now that we have a function for log-likelihood, we simply need to chose the values of theta that maximize it. We can find the best values of theta by using an optimization algorithm. However, in order to use an optimization algorithm, we first need to know the partial derivative of log likelihood with respect to each parameter. First I am going to give you the partial derivative (so you can see how it is used). Then I am going to show you how to derive it:
\begin{align*}
    \frac{\partial LL(\theta)}{\partial \theta_j} = \sum_{i=1}^n \left[
  y^{(i)} - \sigma(\mathbf{\theta}^T\mathbf{x}^{(i)})
 \right] x_j^{(i)}
\end{align*}

<h2>Gradient Descent Optimization</h2>
<p>Our goal is to choosing parameters ($\theta$) that maximize likelihood, and we know the partial derivative of log likelihood with respect to each parameter. We are ready for our optimization algorithm. 

<p>In the case of logistic regression we can't solve for $\theta$ mathematically. Instead we use a computer to chose $\theta$. To do so we employ an algorithm called gradient descent (a classic in optimization theory). The idea behind gradient descent is that if you continuously take small steps downhill (in the direction of your negative gradient), you will eventually make it to a local minima. In our case we want to maximize our likelihood. As you can imagine, minimizing a negative of our likelihood will be equivalent to maximizing our likelihood.

<p>The update to our parameters that results in each small step can be calculated as:
\begin{align*}
 \theta_j^{\text{ new}} &= \theta_j^{\text{ old}} + \eta \cdot \frac{\partial LL(\theta^{\text{ old}})}{\partial \theta_j^{\text{ old}}} \\
&= \theta_j^{\text{ old}} + \eta \cdot \sum_{i=1}^n \left[
  y^{(i)} - \sigma(\mathbf{\theta}^T\mathbf{x}^{(i)})
 \right] x_j^{(i)}
\end{align*}
Where $\eta$ is the magnitude of the step size that we take. If you keep updating $\theta$ using the equation above you will converge on the best values of $\theta$. You now have an intelligent model. Here is the gradient ascent algorithm for logistic regression in pseudo-code:

<p><center>
	<img class="mainFigure" src="../../../img/chapters/gradientAscent.png"></img>
</center></p>

<p>Pro-tip: Don't forget that in order to learn the value of $\theta_0$ you can simply define $\textbf{x}_0$ to always be 1.

<h2>Derivations</h2>
<p>In this section we provide the mathematical derivations for the gradient of log-likelihood. The derivations are worth knowing because these ideas are heavily used in Artificial Neural Networks. 
 
<p>Our goal is to calculate the derivative of the log likelihood with respect to each theta. To start, here is the definition for the derivative of a sigmoid function with respect to its inputs:
 \begin{align*}
     \frac{\partial}{\partial z} \sigma(z) = \sigma(z)[1 - \sigma(z)] && \text{to get the derivative with respect to $\theta$, use the chain rule}
 \end{align*}
Take a moment and appreciate the beauty of the derivative of the sigmoid function. The reason that sigmoid has such a simple derivative stems from the natural exponent in the sigmoid denominator.
 
<p>Since the likelihood function is a sum over all of the data, and in calculus the derivative of a sum is the sum of derivatives, we can focus on computing the derivative of one example. The gradient of theta is simply the sum of this term for each training datapoint.
 
<p>First I am going to show you how to compute the derivative the hard way. Then we are going to look at an easier method. The derivative of gradient for one datapoint $(\mathbf{x}, y)$:
 \begin{align*}
 \frac{\partial LL(\theta)}{\partial \theta_j} &= \frac{\partial }{\partial \theta_j} y \log \sigma(\mathbf{\theta}^T\mathbf{x}) + \frac{\partial }{\partial \theta_j} (1-y) \log [1 - \sigma(\mathbf{\theta}^T\mathbf{x}] && \text{derivative of sum of terms}\\
&=\left[\frac{y}{\sigma(\theta^T\mathbf{x})} - \frac{1-y}{1-\sigma(\theta^T\mathbf{x})} \right] \frac{\partial}{\partial \theta_j} \sigma(\theta^T \mathbf{x}) &&\text{derivative of log $f(x)$}\\
&=\left[\frac{y}{\sigma(\theta^T\mathbf{x})} - \frac{1-y}{1-\sigma(\theta^T\mathbf{x})} \right] \sigma(\theta^T \mathbf{x}) [1 - \sigma(\theta^T \mathbf{x})]\mathbf{x}_j && \text{chain rule + derivative of sigma}\\
&=\left[
\frac{y - \sigma(\theta^T\mathbf{x})}{\sigma(\theta^T \mathbf{x}) [1 - \sigma(\theta^T \mathbf{x})]}
\right] \sigma(\theta^T \mathbf{x}) [1 - \sigma(\theta^T \mathbf{x})]\mathbf{x}_j && \text{algebraic manipulation}\\
&= \left[y - \sigma(\theta^T\mathbf{x}) \right] \mathbf{x}_j && \text{cancelling terms}
 \end{align*}
 
<h2>Derivatives Without Tears</h2>
 
<p>That was the hard way. Logistic regression is the building block of Artificial Neural Networks. If we want to scale up, we are going to have to get used to an easier way of calculating derivatives. For that we are going to have to welcome back our old friend the chain rule. By the chain rule:
\begin{align*}
\frac{\partial LL(\theta)}{\partial \theta_j} &= 
 \frac{\partial LL(\theta)}{\partial p} 
 \cdot  \frac{\partial p}{\partial \theta_j}
 && \text{Where } p =  \sigma(\theta^T\textbf{x})\\
&= 
 \frac{\partial LL(\theta)}{\partial p} 
 \cdot  \frac{\partial p}{\partial z} 
 \cdot  \frac{\partial z}{\partial \theta_j}
 && \text{Where } z =  \theta^T\textbf{x}
 \end{align*}
Chain rule is the decomposition mechanism of calculus. It allows us to calculate a complicated partial derivative ($\frac{\partial LL(\theta)}{\partial \theta_j}$) by breaking it down into smaller pieces.
\begin{align*}
LL(\theta) &= y \log p + (1-y) \log (1 - p) && \text{Where } p =  \sigma(\theta^T\textbf{x}) \\
 \frac{\partial LL(\theta)}{\partial p} &= \frac{y}{p} - \frac{1-y}{1-p} && \text{By taking the derivative}
\end{align*}

\begin{align*}
p &= \sigma(z) && \text{Where }z = \theta^T\textbf{x}\\
\frac{\partial p}{\partial z} &= \sigma(z)[1- \sigma(z)] && \text{By taking the derivative of the sigmoid}
\end{align*}

\begin{align*}
 z &= \theta^T\textbf{x}  && \text{As previously defined}\\
 \frac{\partial z}{\partial \theta_j} &= \textbf{x}_j && \text{ Only $\textbf{x}_j$ interacts with $\theta_j$}
 \end{align*}
Each of those derivatives was much easier to calculate. Now we simply multiply them together.
\begin{align*}
\frac{\partial LL(\theta)}{\partial \theta_j} &=
 \frac{\partial LL(\theta)}{\partial p} 
 \cdot  \frac{\partial p}{\partial z} 
 \cdot  \frac{\partial z}{\partial \theta_j} \\
 &=
\Big[\frac{y}{p} - \frac{1-y}{1-p}\Big]
 \cdot  \sigma(z)[1- \sigma(z)]
 \cdot \textbf{x}_j && \text{By substituting in for each term} \\
&=
\Big[\frac{y}{p} - \frac{1-y}{1-p}\Big]
 \cdot p[1- p]
 \cdot \textbf{x}_j && \text{Since }p =  \sigma(z)\\
 &=
[y(1-p) - p(1-y)]
 \cdot \textbf{x}_j && \text{Multiplying in} \\
 &= [y - p]\textbf{x}_j && \text{Expanding} \\
&= [y - \sigma(\theta^T\textbf{x})]\textbf{x}_j  && \text{Since } p =  \sigma(\theta^T\textbf{x})
 \end{align*}





<script type="text/javascript">
    // const firebase = require("firebase");
    // Required for side-effects
    // require("firebase/firestore");

    $(document).ready(function () {
        console.log('ready')
        const scrollTop = getScrollTop()
        console.log(scrollTop)
        $("#sidebar").scrollTop(scrollTop)
        $("#sidebar").scroll(function() {
          localStorage.scrollTop = $("#sidebar").scrollTop()
        })
        // $("#sidebar").mCustomScrollbar({
        //     theme: "minimal",
        //     mouseWheel: {preventDefault: true},
        //     advanced:{
        //      autoScrollOnFocus: false,
        //      updateOnContentResize: true
        //     },
        //     scrollInertia:0,
        //     contentTouchScroll:1,
        //     mouseWheel: {
        //         scrollAmount:1000
        //     },
        //     setTop:scrollTop + 'px',
        //     callbacks:{
        //         onScroll:function(){
        //             if(hasStorage) {

        //                 localStorage.scrollTop = this.mcs.top;
        //                 console.log(localStorage.scrollTop)
        //             }
        //         }
        //     } 
        // });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });

        
        let lastPart = getUrlKey()
        
        // Bug: this code will highlight anything which matches with the last part
        $("#sidebar").find('a').each(function(){
            // find link which ends with last part and add style
            let currLink = $($(this)[0]).attr('href')
            let currLastPart = getLastPartOfUrl(currLink)
            if (currLastPart === lastPart) {
                $($(this)[0]).addClass('active-link');
            }
        })
    });

    function getScrollTop() {
        if(typeof(Storage) !== "undefined") {
            return Number(localStorage.scrollTop)
        }
        return 0;
    }

    function getUrlKey() {
        var path = window.location.pathname;
        return getLastPartOfUrl(path)
        
    }

    function getLastPartOfUrl(path) {
        let parts = path.split('/')
        var currIndex = parts.length - 1
        while(currIndex >= 0) {
            let nextPart = parts[currIndex]
            if(nextPart) {
                return nextPart
            }
            currIndex -= 1
        }
        return ''
    }

    function submitQuestion() {
        firebase.initializeApp({
          apiKey: "AIzaSyBqZVV7Qrp0DT3aBCCTCTMUCrPJO0pb3tY",
          authDomain: "probability-digital-world.firebaseapp.com",
          projectId: "probability-digital-world"
        });

        var db = firebase.firestore();

        db.collection("questions").add({
            email: $("#question-email").val(),
            question: "Lovelace",
            page: getUrlKey()
        })
        .then(function(docRef) {
            console.log("Document written with ID: ", docRef.id);
            alert('success')
        })
        .catch(function(error) {
            console.error("Error adding document: ", error);
        });
        // // // Generate a new push ID for the new post
        // var questionListRef = db.child("questions")
        // var newQuestionRef = questionListRef.push();
        // newQuestionRef.set({
        //     'title':'test'
        // });
        
    }

    function onCuriosity() {
        Swal.fire({
          title: 'Curious?',
          position: 'bottom-end',
          allowOutsideClick:false,
          backdrop:false,
          confirmButtonText: 'Submit',
          input: 'textarea',
          html:
            '<p>We are trying to make this book better. Let us know if you find something confusing. If you ask a question we will try to answer it. If you find a mistake we will fix it. </p>' +
            '<input placeholder="Your email (optional)..." id="question-email" class="swal2-input">',
          inputPlaceholder: 'Type your question or message here...',
          inputAttributes: {
            'aria-label': 'Type your question or message here'
          },
          showCancelButton: true,
          preConfirm: () => submitQuestion()
        })
    }
</script>

            <br /><br />

          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    // Calculate and set the viewport height
    function setVh() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    // Initial calculation
    setVh();
    // Recalculate on resize or orientation change
    window.addEventListener('resize', setVh);
    window.addEventListener('orientationchange', setVh);

    document.addEventListener('DOMContentLoaded', function() {
        var sidebarCollapse = document.getElementById('sidebarCollapse');
        var sidebar = document.getElementById('sidebar');

        sidebarCollapse.addEventListener('click', function() {
            // Toggle the 'active' class on the sidebar
            // sidebar.classList.toggle('active');
            // Toggle the 'sidebar-open' class on the body
            document.body.classList.toggle('sidebar-open');
        });
    });
  </script>
  <script>

    $(document).ready(function () {
      //addH2Numbers()
      enableSearch()
    })

    function addH2Numbers() {
      $("h2").each(function (i) {
        let title = $(this).html()
        title = `${i + 1}. ${title}`
        $(this).html(title)
      })
    }

    function enableSearch() {
      $("#probability-for-digital-world-search").on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
          let query = $("#probability-for-digital-world-search").val()

          window.location = `../../search.html?q=${query}`
        }
      });
      // $.ajax({
      //     type: "GET",
      //     url: "../../../searchIndex.json",
      //     dataType: "text",
      //     success: function(data) {addSearchIndexData(data);}
      //  });
    }

    function standardPMFConfig(xValues, yValues, xLabel, yLabel) {
      return {
        type: 'bar',
        data: {
          labels: xValues,
          datasets: [{
            label: 'P(x)',
            fill: false,
            backgroundColor: 'blue',
            borderColor: 'blue',
            data: yValues,
            pointRadius: 1,
            maxBarThickness: 100,
            pointHitRadius: 20
          }]
        },
        options: {

          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }

    function standardPDFConfig(xValues, yValues, xLabel, yLabel) {
      return {
        type: 'line',
        data: {
          labels: xValues,
          datasets: [{
            label: 'f(x)',
            fill: false,
            backgroundColor: 'blue',
            borderColor: 'blue',
            data: yValues,
            pointRadius: 1,
            maxBarThickness: 100,
            pointHitRadius: 20
          }]
        },
        options: {
          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }

    function standardPDFsConfig(datasets, xValues, xLabel, yLabel) {
      return {
        type: 'line',
        data: {
          datasets: datasets
        },
        options: {

          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }


    function addSearchIndexData(data) {
      var idx = lunr(function () {
        this.ref('name')
        this.field('text')

        let documents = JSON.parse(data)

        documents.forEach(function (doc) {
          this.add(doc)
        }, this)

        $("#probability-for-digital-world-search").on('keyup', function (e) {
          if (e.key === 'Enter' || e.keyCode === 13) {
            let query = $("#probability-for-digital-world-search").val()
            let results = idx.search(query)
          }
        });
      })
    }

  </script>

</body>




</html>