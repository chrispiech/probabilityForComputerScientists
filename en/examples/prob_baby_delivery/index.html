
<!DOCTYPE html>
<html>

<head>
    

<title>Probability of Baby Delivery</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="content-type" content="text/html; charset=UTF8">

<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
 <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />

<!-- D3 CDN -->
<script src="https://d3js.org/d3.v3.js"></script>
<!-- <script src="https://d3js.org/d3.v4.js"></script> -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- Chart CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js" integrity="sha512-FuXN8O36qmtA+vRJyRoAxPcThh/1KJJp7WSRnjCpqA+13HYGrSWiyzrCHalCWi42L5qH1jt88lX5wy5JyFxhfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- PDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js" integrity="sha512-Z8CqofpIcnJN80feS2uccz+pXWgZzeKxDsDNMD/dJ6997/LSRY+W4NmEt9acwR+Gt9OHN0kkI1CTianCwoqcjQ==" crossorigin="anonymous"></script>

<!-- Lunr CDN -->
 <script src="https://unpkg.com/lunr@2.0.4/lunr.js"></script>

<!-- Firebase CDN -->
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="../../../css/style.css">

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>


   

<!-- Java Script -->
<script src="../../../plugins/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- Probability Packages -->
<script src="../../../js/probabilityUtils.js"></script>
<script src="../../../plugins/probability/gaussian.js"></script>
<script src="../../../plugins/color.js"></script>
<script src='https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js'></script>


<!-- font awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<!-- SWAL -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<!-- Stanford -->
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,600,700' rel='stylesheet' type='text/css'>
<link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">

<!-- Math Jax -->
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script> -->
<script type="text/javascript">
  MathJax = {
    config: ["MMLorHTML.js"],
    jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
    extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js"],
    TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js", "action.js"]
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
	"fast-preview": {
	  disabled: true
	}
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>



<script src="../../../plugins/math.min.js"></script>



    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

 <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="../../../plugins/jquery.mCustomScrollbar.js"></script>

</head>

<script>
  Chart.defaults.font.family = 'Times New Roman';
  Chart.defaults.font.size = 18;
</script>


<!-- I declare a few math operators I often use in equations -->
<div style="display:none">
  $\DeclareMathOperator{\p}{P}$
  $\DeclareMathOperator{\P}{P}$
  $\DeclareMathOperator{\c}{^C}$
  $\DeclareMathOperator{\or}{  or}$
  $\DeclareMathOperator{\and}{  and}$
  $\DeclareMathOperator{\var}{Var}$
  $\DeclareMathOperator{\Var}{Var}$
  $\DeclareMathOperator{\Std}{Std}$
  $\DeclareMathOperator{\E}{E}$
  $\DeclareMathOperator{\std}{Std}$
  $\DeclareMathOperator{\Ber}{Bern}$
  $\DeclareMathOperator{\Bin}{Bin}$
  $\DeclareMathOperator{\Poi}{Poi}$
  $\DeclareMathOperator{\Uni}{Uni}$
  $\DeclareMathOperator{\Geo}{Geo}$
  $\DeclareMathOperator{\NegBin}{NegBin}$
  $\DeclareMathOperator{\Beta}{Beta}$
  $\DeclareMathOperator{\Exp}{Exp}$
  $\DeclareMathOperator{\N}{N}$
  $\DeclareMathOperator{\R}{\mathbb{R}}$
  $\DeclareMathOperator*{\argmax}{arg\,max}$
  $\newcommand{\d}{\, d}$
  
</div>

<body class="greyBackground">


    <div class="wrapper">
        <!-- Sidebar  -->
<nav id="sidebar">
    <div class="sidebar-header">
        <!-- <div></div> -->
        <a style="text-align:left" href="../../index.html"><h3></i> Probability<br/>For Computer Science<br/></h3></a>
    </div>

    <div> 
        <!-- Put a link back to cs109 -->
    

        <!-- This adds a search bar! -->
        <div class="searchCol" style="font-family: 'Source Sans Pro', sans-serif;">
            
            <input type="text" class="form-control bookSearch" id="probability-for-digital-world-search" aria-describedby="search box" placeholder="🔍 Search book..."/>
        </div>
        
    </div>

<!-- intro -->
<ul class="list-unstyled components">
<li>
<a id=sidebar-notation href="../../intro/notation">Notation Reference</a>
<a id=sidebar-core_probability_ref href="../../intro/core_probability_ref">Core Probability Reference</a>
<a id=sidebar-all_distributions href="../../intro/all_distributions">Random Variable Reference</a>
<a id=sidebar-python href="../../intro/python">Python Reference</a>
<a id=sidebar-calculators href="../../intro/calculators">Calculators</a>
</li>
</ul>

<!-- part1 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part1">Part 1: Core Probability</p></li>
<li>
<a id=sidebar-counting href="../../part1/counting">Counting</a>
<a id=sidebar-combinatorics href="../../part1/combinatorics">Combinatorics</a>
<a id=sidebar-probability href="../../part1/probability">Definition of Probability</a>
<a id=sidebar-equally_likely href="../../part1/equally_likely">Equally Likely Outcomes</a>
<a id=sidebar-prob_or href="../../part1/prob_or">Probability of <b>or</b></a>
<a id=sidebar-cond_prob href="../../part1/cond_prob">Conditional Probability</a>
<a id=sidebar-independence href="../../part1/independence">Independence</a>
<a id=sidebar-prob_and href="../../part1/prob_and">Probability of <b>and</b></a>
<a id=sidebar-law_total href="../../part1/law_total">Law of Total Probability</a>
<a id=sidebar-bayes_theorem href="../../part1/bayes_theorem">Bayes' Theorem</a>
<a id=sidebar-log_probabilities href="../../part1/log_probabilities">Log Probabilities</a>
<a id=sidebar-many_flips href="../../part1/many_flips">Many Coin Flips</a>

<li>
    <a href="#part1_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part1_examples">
        <li><a href="../../examples/enigma">Enigma Machine</a></li><li><a href="../../examples/serendipity">Serendipity</a></li><li><a href="../../examples/random_shuffles">Random Shuffles</a></li><li><a href="../../examples/counting_graphs">Random Graphs</a></li><li><a href="../../examples/diversity_shapes">Set Diversity</a></li><li><a href="../../examples/bacteria_evolution">Bacteria Evolution</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part2 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part2">Part 2: Random Variables</p></li>
<li>
<a id=sidebar-rvs href="../../part2/rvs">Random Variables</a>
<a id=sidebar-pmf href="../../part2/pmf">Probability Mass Functions</a>
<a id=sidebar-expectation href="../../part2/expectation">Expectation</a>
<a id=sidebar-variance href="../../part2/variance">Variance</a>
<a id=sidebar-bernoulli href="../../part2/bernoulli">Bernoulli Distribution</a>
<a id=sidebar-binomial href="../../part2/binomial">Binomial Distribution</a>
<a id=sidebar-poisson href="../../part2/poisson">Poisson Distribution</a>
<a id=sidebar-more_discrete href="../../part2/more_discrete">More Discrete Distributions</a>
<a id=sidebar-categorical href="../../part2/categorical">Categorical Distributions</a>
<a id=sidebar-continuous href="../../part2/continuous">Continuous Distribution</a>
<a id=sidebar-uniform href="../../part2/uniform">Uniform Distribution</a>
<a id=sidebar-exponential href="../../part2/exponential">Exponential Distribution</a>
<a id=sidebar-normal href="../../part2/normal">Normal Distribution</a>
<a id=sidebar-binomial_approx href="../../part2/binomial_approx">Binomial Approximation</a>

<li>
    <a href="#part2_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part2_examples">
        <li><a href="../../examples/100_binomial_problems">100 Binomial Problems</a></li><li><a href="../../examples/winning_series">Winning Series</a></li><li><a href="../../examples/approximate_counting">Approximate Counting</a></li><li><a href="../../examples/jury">Jury Selection</a></li><li><a href="../../examples/grading_eye_inflammation">Grading Eye Inflamation</a></li><li><a href="../../examples/grades_not_normal">Grades are Not Normal</a></li><li><a href="../../examples/curse_of_dimensionality">Curse of Dimensionality</a></li><li><a href="../../examples/algorithmic_art">Algorithmic Art</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part3 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part3">Part 3: Probabilistic Models</p></li>
<li>
<a id=sidebar-joint href="../../part3/joint">Joint Probability</a>
<a id=sidebar-marginalization href="../../part3/marginalization">Marginalization</a>
<a id=sidebar-multinomial href="../../part3/multinomial">Multinomial</a>
<a id=sidebar-continuous_joint href="../../part3/continuous_joint">Continuous Joint</a>
<a id=sidebar-inference href="../../part3/inference">Inference</a>
<a id=sidebar-bayesian_networks href="../../part3/bayesian_networks">Bayesian Networks</a>
<a id=sidebar-independent_vars href="../../part3/independent_vars">Independence in Variables</a>
<a id=sidebar-correlation href="../../part3/correlation">Correlation</a>
<a id=sidebar-computational_inference href="../../part3/computational_inference">General Inference</a>

<li>
    <a href="#part3_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part3_examples">
        <li><a href="../../examples/fairness">Fairness in AI</a></li><li><a href="../../examples/federalist">Federalist Paper Authorship</a></li><li><a href="../../examples/name2age">Name to Age</a></li><li><a href="../../examples/prob_baby_delivery">Probability of Baby Delivery</a></li><li><a href="../../examples/bayesian_carbon_dating">Bayesian Carbon Dating</a></li><li><a href="../../examples/digital_vision_test">Digital Vision Test</a></li><li><a href="../../examples/bridge_distribution">Bridge Distribution</a></li><li><a href="../../examples/bayesian_viral_load_test">Bayesian Viral Load Test</a></li><li><a href="../../examples/dart_logo">CS109 Logo</a></li><li><a href="../../examples/tracking_in_2D">Tracking in 2D</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part4 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part4">Part 4: Uncertainty Theory</p></li>
<li>
<a id=sidebar-beta href="../../part4/beta">Beta Distribution</a>
<a id=sidebar-summation_vars href="../../part4/summation_vars">Adding Random Variables</a>
<a id=sidebar-clt href="../../part4/clt">Central Limit Theorem</a>
<a id=sidebar-samples href="../../part4/samples">Sampling</a>
<a id=sidebar-bootstrapping href="../../part4/bootstrapping">Bootstrapping</a>
<a id=sidebar-algorithmic_analysis href="../../part4/algorithmic_analysis">Algorithmic Analysis</a>
<a id=sidebar-information_theory href="../../part4/information_theory">Information Theory</a>

<li>
    <a href="#part4_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part4_examples">
        <li><a href="../../examples/thompson">Thompson Sampling</a></li><li><a href="../../examples/night_sight">Night Sight</a></li><li><a href="../../examples/p_hacking">P-Hacking</a></li><li><a href="../../examples/differential_privacy">Differential Privacy</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part5 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part5">Part 5: Machine Learning</p></li>
<li>
<a id=sidebar-parameter_estimation href="../../part5/parameter_estimation">Parameter Estimation</a>
<a id=sidebar-mle href="../../part5/mle">Maximum Likelihood Estimation</a>
<a id=sidebar-map href="../../part5/map">Maximum A Posteriori</a>
<a id=sidebar-machine_learning href="../../part5/machine_learning">Machine Learning</a>
<a id=sidebar-naive_bayes href="../../part5/naive_bayes">Naïve Bayes</a>
<a id=sidebar-log_regression href="../../part5/log_regression">Logistic Regression</a>

<li>
    <a href="#part5_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part5_examples">
        <li><a href="../../examples/mle_demo">MLE Normal Demo</a></li><li><a href="../../examples/mle_pareto">MLE Pareto Distribution</a></li><li><a href="../../examples/mixture_models">MLE Mixture Model</a></li>
    </ul>
</li>
</li>
</ul>



    <!-- <ul class="list-unstyled components">
        
         <li>
            <p>Part ?: Misfits</p>
        </li>
        <li>
             <a href="../../examples/probBabies.html">Probability and babies</a>
            
             <a href="../../">Sampling from a likelihood function</a>
             <a href="../../">Law of Total Expectation</a>
            
        </li>
    </ul> -->



    <ul class="list-unstyled CTAs">
        <li>
            Ⓒ Chris Piech, Stanford University
            <!-- <a href="https://compedu.stanford.edu/codeinplace/v1/#/course" class="download">Back to Code in Place</a> -->
        </li>
    </ul>
</nav>
        <!-- Page Content  -->
        <div id="content">

<button type="button" id="sidebarCollapse" class="mobile-only btn btn-dark exclude-from-print">
    <i class="fas fa-align-left"></i>
    <span></span>
</button>
            <!-- <button id="curiosityButton" onclick = "onCuriosity()" type="button" class="btn btn-primary btn-sm">
              <span style="font-size:150%">I'm Curious</span>
              <span></span>
          </button> -->
            
            <div class="container-fluid">
                <div class="row d-flex justify-content-center">
                    <div class="col handout" >
              
                        

 
<center><h1>Probability and Babies</h1></center>
<hr/>

<div class="alert alert-primary">
	This demo used to be live. We now know that the delivery happened on Jan 23rd. Lets go back in time to Jan 1st and see what the probability looked like at that point.
</div>

<p>What is the probability that Laura gives birth today (given that she hasn't given birth up until today)?</p>

<div class="input-group mb-3">
  <div class="input-group-prepend">
    <span class="input-group-text" onchange="todayDateChange()" id="todaysDateLabel" style="min-width: 120px">Today's Date</span>
  </div>
  <input type="text" class="form-control"  aria-label="Username" aria-describedby="todaysDateLabel" disabled id="todaysDateInput" value="1/Jan/2021">
</div>

<div class="input-group mb-3">
  <div class="input-group-prepend">
    <span class="input-group-text" id="dueDateLabel" style="min-width: 120px">Due Date</span>
  </div>
  <input type="text" class="form-control" placeholder="Due Date" aria-label="Username" aria-describedby="dueDateLabel" id="dueDateInput" disabled value="18/Jan/2021"></input>
</div>

<hr/>
<p>
Probability of delivery today: <b class="keyValue" id="prDeliveryToday"></b><br/>
Probability of delivery in next 7 days: <b id="prDeliveryWeek"></b><br/>
Current days past due date: <b id="daysPastDue"></b> days<br/>
Unconditioned probability mass before today: <b id="pastProbMass"></b>
</p>
<p>
How likely is delivery, in humans, relative to the due date? There have been millions of births which gives us a relatively good picture [<a href="#cite1">1</a>]. The length of human pregnancy varies by quite a lot! Have you heard that it is 9 months? That is a rough, point estimate. The mean duration of pregnancy is 278.6 days, and pregnancy length has a standard deviation (SD) of 12.5 days. This distribution is not normal, but roughly matches a "<a href="https://en.wikipedia.org/wiki/Skew_normal_distribution">skewed normal</a>". This is a general probability mass function for the first pregnancy collected from hundreds of thousands of women (this PMF is very similar across demographics, but changes based on whether the woman has given birth before):<br/></p>
<p>
<canvas id="unconditionalPMF" style="max-height: 400px"></canvas>
</p>


<p>
Of course, we have more information. Specifically, we know that Laura <b>hasn't</b> given birth up until today (we will update this example when that changes). We also know that babies which are over 14 days late are "<a href="https://en.wikipedia.org/wiki/Labor_induction">induced</a>" on day 14. How likely is delivery given that we haven't delivered up until today? Note that the y-axis is scalled differently:<br/>
</p>
<p>
<canvas id="conditionalPMF" style="max-height: 400px"></canvas>
</p>

<p>

	Let's approach this problem formally using inference. First we introduce a random variable $D$ to represent the days after delivery that the baby is born. Note that $D$ can be negative if the baby is due before the due date. We can use Inference to update our belief in $D$ given our observation that we have not delivered yet:

	$$
	\begin{align}
	\P(D = i | \text{No Baby Yet}) &= \frac{\P(\text{No Baby Yet} | D = i) \P(D = i)}{\P(\text{No Baby Yet})} \\
	\end{align}
	$$
</p>

<p>$\P(\text{No Baby Yet} | D = i)$ is always either 1 or 0. Note that conditioning on $D=i$ means we are being told the actual date of delivery. If the delivery hasn't happened yet (eg today is before $i$) then the probability of No Baby Yet is 1. If the delivery has already happened (eg today is after $i$) then the probability of No Baby Yet is 0.</p>

<p>$\P(D = i)$ is our prior belief (the probability of delivery dates based off historical data). $\P(\text{No Baby Yet})$ is the normalization constant. Instead of calculating it explicity, we can compute the numerators for each value of $i$. We can then normalize the distribution (compute the sum of the numerators, and divide every probability by this sum) in order to implicitly compute it. An equivalent (but more compute heavy) solution would be to expand $\P(\text{No Baby Yet})$ using the law of total probability:
$$
\P(\text{No Baby Yet}) = \sum_i \P(\text{No Baby Yet} | D = i) \P(D = i)
$$

</p>

<p>How do we deal with the fact that babies are induced after $D = 14$? Well we can adjust our prior so that all of the probability for days 14 and on is shifted to day 14. This is equivalent to the following calculation:
$$
\P(D = 14) = \sum_{i \geq 14} \P(D = i)
$$
</p>

<p><pre class="language-python"><code>def update_belief_baby(prior, today = -19):
	# pr_D[i] is P(D = i| No Baby Yet).
	pr_D = {}
	min_i = -50
	max_i = 14
	for i in range(min_i, max_i + 1):
		 # P(NoBaby | D = i)
		 likelihood = 0 if i < today else 1
		 pr_D[i] = likelihood * prior[i]
	# implicitly computes the LOTP
	normalize(pr_D)
	return pr_D

def normalize(unormalized_pmf):
	total_sum = sum(unormalized_pmf.values())
	normalized = {}
	for key, value in unormalized_pmf.items():
		normalized[key] = value / total_sum
	return normalized
</code></pre></p>

<!-- <p>
	Implementation notes: this calculation was performed by storing the PDF as a list of (day, probability) points. These values are sometimes called weighted samples, or "particles" and are the key component to a "<a href="https://en.wikipedia.org/wiki/Particle_filter">particle filtering</a>" approach. After we observe no-delivery, we set the probability of every point which has a day before today to be 0, and then re-normalize the remaining points (aka we "filter" the "particles"). This is convenient because the "posterior" belief doesn't follow a simple equation -- using particles means we never have to write that equation down in our code.
	</p> -->

<p>

	<hr/>

	<h3>Extension Problem</h3>

	<p>Chris had two other good friends who had babies with the exact same due date (Really! This actually happened). What is the probability that all three babies are delivered on the exact same day?</p>

<div class="bordered">

	


		<p>
<!-- Probability of two couples on the same day: <b class="keyValue" id="prDeliveryToday"></b><br/> -->
Probability of three couples on the same day: <b id="pr3SameDay"></b><br/>
</p>

<p>How did we get that number? Let $p_i$ be the probability that one baby is delivered on day $i$ -- this number can be read off the probability mass function.  Let $D_i$ be the event that all three babies are delivered on day $i$. Note that the event $D_i$ is <a href="../../part1/prob_or/">mutually exclusive</a> with the event that all three babies are born on another day (So for example, $D_1$ is mutually exclusive with $D_2$, $D_3$ etc). Let $N=3$ be the event that all babies are born on the same day:

	$$
\begin{align}
\p(N=3) &= \sum_i \p(D_i) && \text{Since days are mutually exclusive} \\
&= \sum_i p_i^3 && \text{Since the three couples are independent} 
\end{align}
	$$

</div>

<hr/>


<span id="cite1">[1]</span> <a href="https://www.sciencedirect.com/science/article/pii/S0029784400011315?casa_token=yV-QZInYkl8AAAAA:0U_Z2dT-r0y1etlX8hRG5ulyrjtzoVXRXIlvJkcSyXhtllUlkhWPNr5f3MJL0LMFzHZv5TwsN4Q">Predicting delivery date by ultrasound and last menstrual period in early gestation</a>
</p>

<p>Acknowledgements: This problem was first posed to me by Chris Gregg.

<script>

const monthNames = ["Jan", "Feb", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];
// global singleton
let table = null
let dueDate = Date.parse('18 Jan 2021 00:18:00 GMT');

$(document).ready(function() {

	$('input').datepicker({
		format: "dd/mm/yyyy",
		onSelect: function(dateText) {
			let currDate = Date.parse(dateText)
	        calculateProbabilities(currDate, dueDate)
	        
	    }
	});
	// addVerticalLinePlugin()
    $.ajax({
        type: "GET",
        url: "../../../data/prLabor.csv",
        dataType: "text",
        success: function(data) {processData(data);}
     });
});


function processData(data) {
	table = loadCsvTable(data)
	let currDate = Date.parse('1 Jan 2021 00:18:00 GMT');
	
	// setInputValue('todaysDateInput', currDate)
	// $("#todaysDateInput").val(currDate)
	// $("#dueDateInput").val(dueDate)
	calculateProbabilities(currDate, dueDate)
}

function setInputValue(inputId, date) {
	console.log(date)	
	let str = `${date}/${monthNames[date.getMonth()]}/${date.getFullYear()}`
	$("#" + inputId).val(str)
}

function calculateProbabilities(currDate, dueDate) {
	let tempTable = JSON.parse(JSON.stringify(table))
	let deltaMs = currDate - dueDate
	let daysPastDue = Math.ceil(deltaMs / 86400000)
	let pastProbMass = calcPastProbMass(tempTable, daysPastDue)

	let unconditionalScatterData = []
	for (var i = 0; i < tempTable.length; i++) {
		let datum = tempTable[i]
		if(datum['day'] >= -51 && datum['day'] <= 25) {
			unconditionalScatterData.push({
				'x':datum['day'],
				'y':datum['probability']
			})
		}
	}
	drawLineGraph("unconditionalPMF", unconditionalScatterData, 'Days past due date', 'Probability of delivery')


	conditionProbabilities(tempTable, pastProbMass)
	let prDeliveryToday = calcPrCurrDay(tempTable, daysPastDue)
	let prDeliveryWeek = calcPrDeliveryWeek(tempTable, daysPastDue)
	let pr3SameDay = calcPrMultiDay(tempTable, daysPastDue)

	$("#daysPastDue").html(daysPastDue)
	$("#pastProbMass").html(pastProbMass.toFixed(3))
	$("#prDeliveryToday").html(prDeliveryToday.toFixed(3))
	$("#prDeliveryWeek").html(prDeliveryWeek.toFixed(3))
	$("#pr3SameDay").html(pr3SameDay.toFixed(3))


	let conditionalScatterData = []
	for (var i = 0; i < tempTable.length; i++) {
		let datum = tempTable[i]
		if(datum['day'] >= -51 && datum['day'] <= 25) {
			let pr = 0.0
			if(datum['day'] >= daysPastDue) {
				pr = datum['probability']
			}
			conditionalScatterData.push({
				'x':datum['day'],
				'y':pr
			})
		}
	}
	drawLineGraph("conditionalPMF", conditionalScatterData, 'Days past due date', 'Probability of delivery')


}

function calcPrMultiDay(table, daysPastDue) {
	console.log(table)
	let prSameDay = 0
	for(var i = 0; i < table.length; i++) {
		let datum = table[i]
		let day = datum['day']
		let prDay = datum['probability']
		prSameDay += prDay ** 3
	}
	return prSameDay
}

function calcPrDeliveryWeek(table, daysPastDue) {
	let prWeek = 0
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		let day = datum['day']
		if(day >= daysPastDue && day <= daysPastDue + 7) {
			prWeek += datum['probability']
		}
	}
	return prWeek
}

function calcPrCurrDay(table, daysPastDue) {
	let pastProbMass = 0
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		let day = datum['day']
		if(day == daysPastDue) {
			return datum['probability']
		}
	}
	return 0.0
}

function conditionProbabilities(table, pastProbMass){
	// first, normalize probabilities with the missing mass
	let denominator = (1 - pastProbMass)
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		datum['probability'] /= denominator
	}

	// second, we note that babies are induced after 14 days.
	let prPostInduced = 0
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		if(datum['day'] > 14) {
			prPostInduced += datum['probability']
		}
	}
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		if(datum['day'] == 14) {
			datum['probability'] += prPostInduced
		}
		if(datum['day'] > 14) {
			datum['probability'] = 0
		}
	}
}

function calcPastProbMass(table, daysPastDue) {
	let pastProbMass = 0
	for (var i = 0; i < table.length; i++) {
		let datum = table[i]
		let day = datum['day']
		let prDay = datum['probability']
		if(day < daysPastDue) {
			pastProbMass += prDay
		}
	}
	return pastProbMass
}

function loadCsvTable(allText) {
	let lines = allText.split("\n");
	let head = lines[0].split(',')
	let body = lines.slice(1);
	let data = []
	for (var i = 0; i < body.length; i++) {
		let nextLine = body[i].split(',')
		data.push(makeNewDatum(head, nextLine))
	}
	return data
}

function makeNewDatum(head, nextLine){
	let datum = {}
	for (var i = 0; i < head.length; i++) {
		let key = head[i]
		let value = parseFloat(nextLine[i])
		datum[key] = value
	}
	return datum
}

function drawLineGraph(parentDivId, dataPoints, xLabel = 'x', yLabel = 'y') {
	console.log('draw graph', parentDivId)
	var xValues = []
	var yValues = []
	for (var i = 0; i < dataPoints.length; i++) {
		let point = dataPoints[i]
		xValues.push(point['x'])
		yValues.push(point['y'].toFixed(5))
	}

	var config = {
		type: 'bar',
		
		data: {
			labels: xValues,
			datasets: [{
				label: yLabel,
				fill: false,
				backgroundColor: 'blue',
				borderColor: 'blue',
				data: yValues,
				pointRadius:1
			}]
		},
		options: {
			plugins: {
		    autocolors: false,
		    annotation: {
		      annotations: {
		        line1: {
		          type: 'line',
		          xMin: 51,
		          xMax: 51,
		          borderColor: 'rgb(0, 0, 0)',
		          borderWidth: 2,
		        }
		      }
		    }
		  },
			steppedLine: false,
			responsive: true,
			tooltips: {
				mode: 'index',
				intersect: false,
			},
			hover: {
				mode: 'nearest',
				intersect: true
			},
			legend: {
	            display: false
	         },
			scales: {
				xAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: xLabel
					}
				}],
				yAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: yLabel
					},
					ticks: {
                        // callback: function (value) {
                        //     return parseFloat(value).toFixed(2)
                        // }
                    }
				}]
			}
		}
	};
	var ctx = document.getElementById(parentDivId).getContext('2d');
	window.myLine = new Chart(ctx, config);
}

function addVerticalLinePlugin() {
	const verticalLinePlugin = {
	  getLinePosition: function (chart, pointIndex) {
	      const meta = chart.getDatasetMeta(0); // first dataset is used to discover X coordinate of a point
	      const data = meta.data;
	      return data[pointIndex]._model.x;
	  },
	  renderVerticalLine: function (chartInstance, pointIndex) {
	      const lineLeftOffset = this.getLinePosition(chartInstance, pointIndex);
	      const scale = chartInstance.scales['y-axis-0'];
	      const context = chartInstance.chart.ctx;

	      // render vertical line
	      context.beginPath();
	      context.strokeStyle = '#000000';
	      context.moveTo(lineLeftOffset, scale.top);
	      context.lineTo(lineLeftOffset, scale.bottom);
	      context.stroke();

	      // write label
	      context.fillStyle = "#000000";
	      context.textAlign = 'center';
	      context.fillText('Due Date', lineLeftOffset, (scale.bottom - scale.top) *0.05 + scale.top);
	  },

	  afterDatasetsDraw: function (chart, easing) {
	      if (chart.config.lineAtIndex) {
	          chart.config.lineAtIndex.forEach(pointIndex => this.renderVerticalLine(chart, pointIndex));
	      }
	  }
  };

  Chart.plugins.register(verticalLinePlugin);
}
	
</script>


                        



<script type="text/javascript">
    // const firebase = require("firebase");
    // Required for side-effects
    // require("firebase/firestore");

    $(document).ready(function () {
        console.log('ready')
        const scrollTop = getScrollTop()
        console.log(scrollTop)
        $("#sidebar").scrollTop(scrollTop)
        $("#sidebar").scroll(function() {
          localStorage.scrollTop = $("#sidebar").scrollTop()
        })
        // $("#sidebar").mCustomScrollbar({
        //     theme: "minimal",
        //     mouseWheel: {preventDefault: true},
        //     advanced:{
        //      autoScrollOnFocus: false,
        //      updateOnContentResize: true
        //     },
        //     scrollInertia:0,
        //     contentTouchScroll:1,
        //     mouseWheel: {
        //         scrollAmount:1000
        //     },
        //     setTop:scrollTop + 'px',
        //     callbacks:{
        //         onScroll:function(){
        //             if(hasStorage) {

        //                 localStorage.scrollTop = this.mcs.top;
        //                 console.log(localStorage.scrollTop)
        //             }
        //         }
        //     } 
        // });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });

        
        let lastPart = getUrlKey()
        
        // Bug: this code will highlight anything which matches with the last part
        $("#sidebar").find('a').each(function(){
            // find link which ends with last part and add style
            let currLink = $($(this)[0]).attr('href')
            let currLastPart = getLastPartOfUrl(currLink)
            if (currLastPart === lastPart) {
                $($(this)[0]).addClass('active-link');
            }
        })
    });

    function getScrollTop() {
        if(typeof(Storage) !== "undefined") {
            return Number(localStorage.scrollTop)
        }
        return 0;
    }

    function getUrlKey() {
        var path = window.location.pathname;
        return getLastPartOfUrl(path)
        
    }

    function getLastPartOfUrl(path) {
        let parts = path.split('/')
        var currIndex = parts.length - 1
        while(currIndex >= 0) {
            let nextPart = parts[currIndex]
            if(nextPart) {
                return nextPart
            }
            currIndex -= 1
        }
        return ''
    }

    function submitQuestion() {
        firebase.initializeApp({
          apiKey: "AIzaSyBqZVV7Qrp0DT3aBCCTCTMUCrPJO0pb3tY",
          authDomain: "probability-digital-world.firebaseapp.com",
          projectId: "probability-digital-world"
        });

        var db = firebase.firestore();

        db.collection("questions").add({
            email: $("#question-email").val(),
            question: "Lovelace",
            page: getUrlKey()
        })
        .then(function(docRef) {
            console.log("Document written with ID: ", docRef.id);
            alert('success')
        })
        .catch(function(error) {
            console.error("Error adding document: ", error);
        });
        // // // Generate a new push ID for the new post
        // var questionListRef = db.child("questions")
        // var newQuestionRef = questionListRef.push();
        // newQuestionRef.set({
        //     'title':'test'
        // });
        
    }

    function onCuriosity() {
        Swal.fire({
          title: 'Curious?',
          position: 'bottom-end',
          allowOutsideClick:false,
          backdrop:false,
          confirmButtonText: 'Submit',
          input: 'textarea',
          html:
            '<p>We are trying to make this book better. Let us know if you find something confusing. If you ask a question we will try to answer it. If you find a mistake we will fix it. </p>' +
            '<input placeholder="Your email (optional)..." id="question-email" class="swal2-input">',
          inputPlaceholder: 'Type your question or message here...',
          inputAttributes: {
            'aria-label': 'Type your question or message here'
          },
          showCancelButton: true,
          preConfirm: () => submitQuestion()
        })
    }
</script>

                         <br/><br/>
                
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

$(document).ready(function() {
  //addH2Numbers()
  enableSearch()
})

function addH2Numbers() {
  $("h2").each(function(i){
    let title = $(this).html()
    title = `${i+1}. ${title}`
    $(this).html(title)
  })
}

function enableSearch() {
  $("#probability-for-digital-world-search").on('keyup', function (e) {
      if (e.key === 'Enter' || e.keyCode === 13) {
          let query = $("#probability-for-digital-world-search").val()
          
          window.location = `../../search.html?q=${query}`
      }
  });
  // $.ajax({
  //     type: "GET",
  //     url: "../../../searchIndex.json",
  //     dataType: "text",
  //     success: function(data) {addSearchIndexData(data);}
  //  });
}

function standardPMFConfig(xValues, yValues, xLabel, yLabel){
  return {
    type: 'bar',
    data: {
      labels: xValues,
      datasets: [{
        label: 'P(x)',
        fill: false,
        backgroundColor: 'blue',
        borderColor: 'blue',
        data: yValues,
        pointRadius:1,
        maxBarThickness:100,
        pointHitRadius: 20
      }]
    },
    options: {

      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}

function standardPDFConfig(xValues, yValues, xLabel, yLabel){
  return {
    type: 'line',
    data: {
      labels: xValues,
      datasets: [{
        label: 'f(x)',
        fill: false,
        backgroundColor: 'blue',
        borderColor: 'blue',
        data: yValues,
        pointRadius:1,
        maxBarThickness:100,
        pointHitRadius: 20
      }]
    },
    options: {
      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}

function standardPDFsConfig(datasets, xValues, xLabel, yLabel){
  return {
    type: 'line',
    data: {
      datasets: datasets
    },
    options: {

      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}


function addSearchIndexData(data) {
  var idx = lunr(function () {
    this.ref('name')
    this.field('text')

    let documents = JSON.parse(data)

    documents.forEach(function (doc) {
      this.add(doc)
    }, this)

    $("#probability-for-digital-world-search").on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            let query = $("#probability-for-digital-world-search").val()
            let results = idx.search(query)
        }
    });
  })
}

    </script>

</body>




</html>