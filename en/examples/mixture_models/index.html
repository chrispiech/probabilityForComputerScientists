<!DOCTYPE html>
<html>

<head>


<title>Mixture Models</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="content-type" content="text/html; charset=UTF8">

<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
 <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />

<!-- D3 CDN -->
<script src="https://d3js.org/d3.v3.js"></script>
<!-- <script src="https://d3js.org/d3.v4.js"></script> -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- Chart CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js" integrity="sha512-FuXN8O36qmtA+vRJyRoAxPcThh/1KJJp7WSRnjCpqA+13HYGrSWiyzrCHalCWi42L5qH1jt88lX5wy5JyFxhfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- PDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js" integrity="sha512-Z8CqofpIcnJN80feS2uccz+pXWgZzeKxDsDNMD/dJ6997/LSRY+W4NmEt9acwR+Gt9OHN0kkI1CTianCwoqcjQ==" crossorigin="anonymous"></script>

<!-- Lunr CDN -->
 <script src="https://unpkg.com/lunr@2.0.4/lunr.js"></script>

<!-- Firebase CDN -->
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="../../../css/style.css">

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>


   

<!-- Java Script -->
<script src="../../../plugins/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- Probability Packages -->
<script src="../../../js/probabilityUtils.js"></script>
<script src="../../../plugins/probability/gaussian.js"></script>
<script src="../../../plugins/color.js"></script>
<script src='https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js'></script>


<!-- font awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<!-- SWAL -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<!-- Stanford -->
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,600,700' rel='stylesheet' type='text/css'>
<link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">

<!-- Math Jax -->
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script> -->
<script type="text/javascript">
  MathJax = {
    config: ["MMLorHTML.js"],
    jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
    extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js"],
    TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js", "action.js"]
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
	"fast-preview": {
	  disabled: true
	}
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>



<script src="../../../plugins/math.min.js"></script>



    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

 <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="../../../plugins/jquery.mCustomScrollbar.js"></script>

</head>

<script>
  Chart.defaults.font.family = 'Times New Roman';
  Chart.defaults.font.size = 18;
</script>


<!-- I declare a few math operators I often use in equations -->
<div style="display:none">
  $\DeclareMathOperator{\p}{P}$
  $\DeclareMathOperator{\P}{P}$
  $\DeclareMathOperator{\c}{^C}$
  $\DeclareMathOperator{\or}{ or}$
  $\DeclareMathOperator{\and}{ and}$
  $\DeclareMathOperator{\var}{Var}$
  $\DeclareMathOperator{\Var}{Var}$
  $\DeclareMathOperator{\Std}{Std}$
  $\DeclareMathOperator{\E}{E}$
  $\DeclareMathOperator{\std}{Std}$
  $\DeclareMathOperator{\Ber}{Bern}$
  $\DeclareMathOperator{\Bin}{Bin}$
  $\DeclareMathOperator{\Poi}{Poi}$
  $\DeclareMathOperator{\Uni}{Uni}$
  $\DeclareMathOperator{\Geo}{Geo}$
  $\DeclareMathOperator{\NegBin}{NegBin}$
  $\DeclareMathOperator{\Beta}{Beta}$
  $\DeclareMathOperator{\Exp}{Exp}$
  $\DeclareMathOperator{\N}{N}$
  $\DeclareMathOperator{\R}{\mathbb{R}}$
  $\DeclareMathOperator*{\argmax}{arg\,max}$
  $\newcommand{\d}{\, d}$

</div>




<body class="greyBackground">

<nav id="sidebar">
    <div class="sidebar-header">
        <!-- <div></div> -->
        <a style="text-align:left" href="../../index.html"><h3></i> Probability<br/>For Computer Science<br/></h3></a>
    </div>

    <div> 
        <!-- Put a link back to cs109 -->
    

        <!-- This adds a search bar! -->
        <div class="searchCol" style="font-family: 'Source Sans Pro', sans-serif;">
            
            <input type="text" class="form-control bookSearch" id="probability-for-digital-world-search" aria-describedby="search box" placeholder="🔍 Search book..."/>
        </div>
        
    </div>

<!-- intro -->
<ul class="list-unstyled components">
<li>
<a id=sidebar-notation href="../../intro/notation">Notation Reference</a>
<a id=sidebar-core_probability_ref href="../../intro/core_probability_ref">Core Probability Reference</a>
<a id=sidebar-all_distributions href="../../intro/all_distributions">Random Variable Reference</a>
<a id=sidebar-python href="../../intro/python">Python Reference</a>
<a id=sidebar-calculators href="../../intro/calculators">Calculators</a>
</li>
</ul>

<!-- part1 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part1">Part 1: Core Probability</p></li>
<li>
<a id=sidebar-counting href="../../part1/counting">Counting</a>
<a id=sidebar-combinatorics href="../../part1/combinatorics">Combinatorics</a>
<a id=sidebar-probability href="../../part1/probability">Definition of Probability</a>
<a id=sidebar-equally_likely href="../../part1/equally_likely">Equally Likely Outcomes</a>
<a id=sidebar-prob_or href="../../part1/prob_or">Probability of <b>or</b></a>
<a id=sidebar-cond_prob href="../../part1/cond_prob">Conditional Probability</a>
<a id=sidebar-independence href="../../part1/independence">Independence</a>
<a id=sidebar-prob_and href="../../part1/prob_and">Probability of <b>and</b></a>
<a id=sidebar-law_total href="../../part1/law_total">Law of Total Probability</a>
<a id=sidebar-bayes_theorem href="../../part1/bayes_theorem">Bayes' Theorem</a>
<a id=sidebar-log_probabilities href="../../part1/log_probabilities">Log Probabilities</a>
<a id=sidebar-many_flips href="../../part1/many_flips">Many Coin Flips</a>

<li>
    <a href="#part1_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part1_examples">
        <li><a href="../../examples/enigma">Enigma Machine</a></li><li><a href="../../examples/serendipity">Serendipity</a></li><li><a href="../../examples/random_shuffles">Random Shuffles</a></li><li><a href="../../examples/counting_graphs">Random Graphs</a></li><li><a href="../../examples/diversity_shapes">Set Diversity</a></li><li><a href="../../examples/bacteria_evolution">Bacteria Evolution</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part2 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part2">Part 2: Random Variables</p></li>
<li>
<a id=sidebar-rvs href="../../part2/rvs">Random Variables</a>
<a id=sidebar-pmf href="../../part2/pmf">Probability Mass Functions</a>
<a id=sidebar-expectation href="../../part2/expectation">Expectation</a>
<a id=sidebar-variance href="../../part2/variance">Variance</a>
<a id=sidebar-bernoulli href="../../part2/bernoulli">Bernoulli Distribution</a>
<a id=sidebar-binomial href="../../part2/binomial">Binomial Distribution</a>
<a id=sidebar-poisson href="../../part2/poisson">Poisson Distribution</a>
<a id=sidebar-more_discrete href="../../part2/more_discrete">More Discrete Distributions</a>
<a id=sidebar-categorical href="../../part2/categorical">Categorical Distributions</a>
<a id=sidebar-continuous href="../../part2/continuous">Continuous Distribution</a>
<a id=sidebar-uniform href="../../part2/uniform">Uniform Distribution</a>
<a id=sidebar-exponential href="../../part2/exponential">Exponential Distribution</a>
<a id=sidebar-normal href="../../part2/normal">Normal Distribution</a>
<a id=sidebar-binomial_approx href="../../part2/binomial_approx">Binomial Approximation</a>

<li>
    <a href="#part2_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part2_examples">
        <li><a href="../../examples/100_binomial_problems">100 Binomial Problems</a></li><li><a href="../../examples/winning_series">Winning Series</a></li><li><a href="../../examples/approximate_counting">Approximate Counting</a></li><li><a href="../../examples/jury">Jury Selection</a></li><li><a href="../../examples/grading_eye_inflammation">Grading Eye Inflamation</a></li><li><a href="../../examples/grades_not_normal">Grades are Not Normal</a></li><li><a href="../../examples/curse_of_dimensionality">Curse of Dimensionality</a></li><li><a href="../../examples/algorithmic_art">Algorithmic Art</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part3 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part3">Part 3: Probabilistic Models</p></li>
<li>
<a id=sidebar-joint href="../../part3/joint">Joint Probability</a>
<a id=sidebar-marginalization href="../../part3/marginalization">Marginalization</a>
<a id=sidebar-multinomial href="../../part3/multinomial">Multinomial</a>
<a id=sidebar-continuous_joint href="../../part3/continuous_joint">Continuous Joint</a>
<a id=sidebar-inference href="../../part3/inference">Inference</a>
<a id=sidebar-bayesian_networks href="../../part3/bayesian_networks">Bayesian Networks</a>
<a id=sidebar-independent_vars href="../../part3/independent_vars">Independence in Variables</a>
<a id=sidebar-correlation href="../../part3/correlation">Correlation</a>
<a id=sidebar-computational_inference href="../../part3/computational_inference">General Inference</a>

<li>
    <a href="#part3_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part3_examples">
        <li><a href="../../examples/fairness">Fairness in AI</a></li><li><a href="../../examples/federalist">Federalist Paper Authorship</a></li><li><a href="../../examples/name2age">Name to Age</a></li><li><a href="../../examples/prob_baby_delivery">Probability of Baby Delivery</a></li><li><a href="../../examples/bayesian_carbon_dating">Bayesian Carbon Dating</a></li><li><a href="../../examples/digital_vision_test">Digital Vision Test</a></li><li><a href="../../examples/bridge_distribution">Bridge Distribution</a></li><li><a href="../../examples/expectation_of_sums">Expectation of Sum Proof</a></li><li><a href="../../examples/bayesian_viral_load_test">Bayesian Viral Load Test</a></li><li><a href="../../examples/dart_logo">CS109 Logo</a></li><li><a href="../../examples/tracking_in_2D">Tracking in 2D</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part4 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part4">Part 4: Uncertainty Theory</p></li>
<li>
<a id=sidebar-beta href="../../part4/beta">Beta Distribution</a>
<a id=sidebar-summation_vars href="../../part4/summation_vars">Adding Random Variables</a>
<a id=sidebar-clt href="../../part4/clt">Central Limit Theorem</a>
<a id=sidebar-samples href="../../part4/samples">Sampling</a>
<a id=sidebar-bootstrapping href="../../part4/bootstrapping">Bootstrapping</a>
<a id=sidebar-algorithmic_analysis href="../../part4/algorithmic_analysis">Algorithmic Analysis</a>
<a id=sidebar-information_theory href="../../part4/information_theory">Information Theory</a>
<a id=sidebar-divergence href="../../part4/divergence">Distance Between Distributions</a>

<li>
    <a href="#part4_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part4_examples">
        <li><a href="../../examples/thompson">Thompson Sampling</a></li><li><a href="../../examples/night_sight">Night Sight</a></li><li><a href="../../examples/p_hacking">P-Hacking</a></li><li><a href="../../examples/differential_privacy">Differential Privacy</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part5 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part5">Part 5: Machine Learning</p></li>
<li>
<a id=sidebar-parameter_estimation href="../../part5/parameter_estimation">Parameter Estimation</a>
<a id=sidebar-mle href="../../part5/mle">Maximum Likelihood Estimation</a>
<a id=sidebar-map href="../../part5/map">Maximum A Posteriori</a>
<a id=sidebar-machine_learning href="../../part5/machine_learning">Machine Learning</a>
<a id=sidebar-naive_bayes href="../../part5/naive_bayes">Naïve Bayes</a>
<a id=sidebar-log_regression href="../../part5/log_regression">Logistic Regression</a>

<li>
    <a href="#part5_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part5_examples">
        <li><a href="../../examples/mle_demo">MLE Normal Demo</a></li><li><a href="../../examples/mle_pareto">MLE Pareto Distribution</a></li><li><a href="../../examples/mixture_models">MLE Mixture Model</a></li>
    </ul>
</li>
</li>
</ul>


    <ul class="list-unstyled CTAs">
        <li>
            Ⓒ Chris Piech, Stanford University
        </li>
    </ul>
</nav>

  <div class="wrapper">


    <!-- Page Content  -->
    <div id="content">

<button type="button" id="sidebarCollapse" class="mobile-only btn btn-dark exclude-from-print">
    <i class="fas fa-align-left"></i>
    <span></span>
</button>
      <div class="container-fluid">
        <div class="row d-flex justify-content-center">
          <div class="col handout">

            
 
<center><h1>Gaussian Mixtures</h1></center>
<hr/>

<!-- 
  >>> from scipy import stats
def sample():
   t = stats.bernoulli.rvs(0.8)
   if t ==1:
      return stats.norm.rvs(6.8,0.7)
   else:
      return stats.norm.rvs(3.5,0.7)

data = []
for i in range(50):
   s = sample()
   n = round(s * 100)/100
   data.append(n)
-->


<p><div class="bordered">
Data = [6.47, 5.82, 8.7, 4.76, 7.62, 6.95, 7.44, 6.73, 3.38, 5.89, 7.81, 6.93, 7.23, 6.25, 5.31, 7.71, 7.42, 5.81, 4.03, 7.09, 7.1, 7.62, 7.74, 6.19, 7.3, 7.37, 6.99, 2.97, 3.3, 7.08, 6.23, 3.67, 3.05, 6.67, 6.5, 6.08, 3.7, 6.76, 6.56, 3.61, 7.25, 7.34, 6.27, 6.54, 5.83, 6.44, 5.34, 7.7, 4.19, 7.34]
</div></p>


<div class="d-flex">
  <div>
Parameter $t$: <input onchange="redrawMixturePdf()" type="number" class="form-control example-inline-input" id="mixtureT" value="0.2" step = ".1">
  </div>
  <div class="mr-2">
Parameter $\mu_a$: <input onchange="redrawMixturePdf()" type="number" class="form-control example-inline-input " id="normalPdfMu1" value="3.5" step = ".1">
  </div>
  <div>
Parameter $\sigma_a$: <input onchange="redrawMixturePdf()" type="number" class="form-control example-inline-input" id="normalPdfSigma1" value="0.7" step = ".1">
  </div>
  <div class="mr-2">
Parameter $\mu_b$: <input onchange="redrawMixturePdf()" type="number" class="form-control example-inline-input " id="normalPdfMu2" value="6.8" step = ".1">
  </div>
  <div>
Parameter $\sigma_b$: <input onchange="redrawMixturePdf()" type="number" class="form-control example-inline-input" id="normalPdfSigma2" value="0.7" step = ".1">
  </div>

</div>

<canvas id="mixturePdf" style="max-height: 400px"></canvas>

<p>Likelihood: <span id="likelihood"></span><br/>
    Log Likelihood: <span style="color:blue" id="ll"></span><br/>
    Best Seen: <span style="color:blue"  id="best"></span> 

<h3>What is a Gaussian Mixture?</h3>

<p>A Gaussian Mixture describes a random variable whose PDF could come from one of two Gaussians (or more, but we will just use two in this demo). There is a certain probability the sample will come from the first gaussian, otherwise it comes from the second. It has five parameters: 4 to describe the two gaussians and one to describe the relative weighting of the two gaussians.

<h4>Generative Code</h4>

<p><pre class="language-python"><code>from scipy import stats
def sample():
   # choose group membership
   membership = stats.bernoulli.rvs(0.2)
   if membership == 1:
      # sample from gaussian 1
      return stats.norm.rvs(3.5,0.7)
   else:
      # sample from gaussian 2
      return stats.norm.rvs(6.8,0.7)</code></pre></p>


<h4>Probability Density Function</h4>

\begin{align*}
f(X=x) = t \cdot f(A=x) + (1-t) \cdot f(B=x)
\end{align*}
$$\text{st}$$
$$A \sim N(\mu_a, \sigma_a^2)$$
$$B \sim N(\mu_b, \sigma_b^2)$$
<p>Putting it all together, the PDF of a Gaussian Mixture is:</p>
\begin{align*}
f(x) = t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x-\mu_a}{\sigma_a})^2}\Big)

+ (1-t) \cdot
\Big(\frac{1}{\sqrt{2\pi}\sigma_b} e^{-\frac{1}{2}(\frac{x-\mu_b}{\sigma_b})^2}\Big)
\end{align*}


<h3>MLE for Gaussian Mixture</h3>

<p>Special note: even though the generative story has a bernoulli (group membership) it is never observed. MLE maximizes the likelihood of the observed data.

<p>Let $\vec{\theta} = [t, \mu_a,\mu_b,\sigma_a, \sigma_b]$ be the parameters. Because the math will get long I will use $\theta$ as notation in place of $\vec{\theta}$. Just keep in mind that it is a vector.

<p>The MLE idea is to chose values of $\theta$ which maximize log likelihood. All optimization methods require us to calculate the partial derivatives of the thing we want to optimize (log likelihood) with respect to the values we can change (our parameters).


<h4> Likelihood function</h4>

\begin{align*}
L(\theta) &= \prod_i^n f(x_i | \theta) \\
&= \prod_i^n \Big[t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}\Big)
+ (1-t) \cdot
\Big(\frac{1}{\sqrt{2\pi}\sigma_b} e^{-\frac{1}{2}(\frac{x_i-\mu_b}{\sigma_b})^2}\Big)
\Big]
\end{align*}

<h4> Log Likelihood function</h4>

\begin{align*}
LL(\theta) 
&= \log L(\theta) \\
&= \log \prod_i^n f(x_i | \theta) \\

&=  \sum_i^n \log f(x_i | \theta) \\

\end{align*}
<p>That is sufficient for now, but if you wanted to expand out the term you would get:
  \begin{align*}
LL(\theta)  &= \sum_i^n \log  \Big[t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}\Big)
+ (1-t) \cdot
\Big(\frac{1}{\sqrt{2\pi}\sigma_b} e^{-\frac{1}{2}(\frac{x_i-\mu_b}{\sigma_b})^2}\Big)
\Big] 
\end{align*}


<h4> Derivative of LL with respect to $\theta$</h4>



<p>Here is an example of calculating a partial derivative with respect to one of the parameters, $\mu_a$. You would need a derivative like this for all parameters. 

  <div class="alert alert-warning"><b>Caution:</b> When I first wrote this demo I thought it would be a simple derivative . It is not so simple because the log has a sum in it. As such the log term doesn't reduce. The log still serves to make the outer $\prod$ into a $\sum$. As such the $LL$ partial derivatives are solvable, but the proof uses quite a lot of chain rule. </div>

   <div class="alert alert-primary"><b>Takeaway:</b> The main takeaway from this section (in case you want to skip the derivative proof) is that the resulting derivative is complex enough that we will want a way to compute argmax without having to set that derivative equal to zero and solving for $\mu_a$. Enter gradient descent!</div>

<p>A good first step when doing a huge derivative of a log likelihood function is to think of the derivative for the log of likelihood of a single datapoint. This is the inner sum in the log likelihood expression:
 $$
  \frac{\d}{\d \mu_a} \log f(x_i|\theta) 
  $$
</p>

<p> Before we start:  notice that $\mu_a$ does not show up in this term from $f(x_i|\theta) $:
  $$(1-t) \cdot
\Big(\frac{1}{\sqrt{2\pi}\sigma_b} e^{-\frac{1}{2}(\frac{x_i-\mu_b}{\sigma_b})^2}\Big) =K $$
In the proof, when we encounter this term, we are going to think of it as a constant which we call $K$. Ok, lets go for it!

\begin{align*}
\frac{\d}{\d \mu_a} & \log f(x_i|\theta) \\

&= \frac{1}{f(x_i|\theta)} \frac{\d}{\d \mu_a} f(x_i|\theta) &&\text{chain rule on }\log \\

&= \frac{1}{f(x_i|\theta)} \frac{\d}{\d \mu_a} \Big[t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}\Big)
+ K\Big]  &&\text{substitute in }f(x_i|\theta)\\

&= \frac{1}{f(x_i|\theta)} \frac{\d}{\d \mu_a} \Big[t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}\Big)\Big]  &&\frac{\d}{\d \mu_a} K = 0\\

&= \frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a} \cdot \frac{\d}{\d \mu_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}  &&\text{pull out const}\\

&= \frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a} \cdot  e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2} \cdot \frac{\d}{\d \mu_a} -\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2&&\text{chain on }e^x \\

&= \frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a} \cdot  e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}  \cdot \Big[-(\frac{x_i-\mu_a}{\sigma_a}) \frac{\d}{\d \mu_a} (\frac{x_i-\mu_a}{\sigma_a})\Big]&&\text{chain on }x^2 \\

&= \frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a} \cdot  e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2} \cdot \Big[ -(\frac{x_i-\mu_a}{\sigma_a}) \cdot \frac{-1}{\sigma_a}\Big] &&\text{final derivative} \\

&= \frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a^3} \cdot  e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2} \cdot (x_i-\mu_a)   &&\text{simplify} \\
\end{align*}

<p>That was for a single data-point. For the full dataset:
\begin{align*}
\frac{\d LL(\theta)}{\d \mu_a} 
&=  \sum_i^n 
\frac{\d}{\d \mu_a}  \log f(x_i|\theta)\\
&= \sum_i^n 
\frac{t}{f(x_i|\theta) \sqrt{2\pi}\sigma_a^3} \cdot  e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2} \cdot (x_i-\mu_a)
\end{align*}

<p>This process should be repeated for all five parameters! Now, how should we find a value of $\mu_a$, which, in the presence of the other settings to parameters, and the data, makes this derivative zero? Setting the derivative = 0 and solving for $\mu_a$ is not going to work.

<h3>Use an Optimizer to Estimate Params</h3>


<p>Once we have a $LL$ function and the derivative of $LL$ with respect to each parameter we are ready to compute argmax using an optimizer. In this case the best choice would probably be gradient ascent (or gradient descent with negative log likelihood).

\begin{align*}
\nabla_{\theta} LL(\theta)
&=\begin{bmatrix}
\frac{\d LL(\theta)}{\d t}\\
\frac{\d LL(\theta)}{\d \mu_a}\\
\frac{\d LL(\theta)}{\d \mu_b}\\
\frac{\d LL(\theta)}{\d \sigma_a}\\
\frac{\d LL(\theta)}{\d \sigma_b}\\
\end{bmatrix}
\end{align*}

<!-- <p>\begin{align*}
\frac{\d}{\d \mu_a} LL(\theta) &= \sum_i^n  \frac{\d}{\d \mu_a} \log  \Big[t \cdot 
\Big(\frac{1}{\sqrt{2\pi}\sigma_a} e^{-\frac{1}{2}(\frac{x_i-\mu_a}{\sigma_a})^2}\Big)
+ K] 

\end{align*}</p> -->

 <!--  <p>Notice how few terms actually contain $\mu_a$. Any term which does not have $\mu_a$ in it will have a zero derivative.
<p>\begin{align*}
\frac{\d LL(\vec{\theta})}{\d \mu_a} 
&= \sum_i^n \frac{\d}{\d \mu_a}
\Big[
-\frac{1}{2}\Big(\frac{x_i-\mu_a}{\sigma_a}\Big)^2 
\Big]\\
&= \sum_i^n 2\Big(\frac{x_i-\mu_a}{\sigma_a}\Big)\frac{1}{\sigma_a}

\end{align*}</p> -->



<script>

var best = null

let DATA = [6.47, 5.82, 8.7, 4.76, 7.62, 6.95, 7.44, 6.73, 3.38, 5.89, 7.81, 6.93, 7.23, 6.25, 5.31, 7.71, 7.42, 5.81, 4.03, 7.09, 7.1, 7.62, 7.74, 6.19, 7.3, 7.37, 6.99, 2.97, 3.3, 7.08, 6.23, 3.67, 3.05, 6.67, 6.5, 6.08, 3.7, 6.76, 6.56, 3.61, 7.25, 7.34, 6.27, 6.54, 5.83, 6.44, 5.34, 7.7, 4.19, 7.34]

$(document).ready(function(){
  redrawMixturePdf()
})

function redrawMixturePdf() {
  let parentDivId = 'mixturePdf'
  let mu1 = parseFloat($("#normalPdfMu1").val())
  let sigma1 = parseFloat($("#normalPdfSigma1").val())
  let mu2 = parseFloat($("#normalPdfMu2").val())
  let sigma2 = parseFloat($("#normalPdfSigma2").val())
  let mixtureT = parseFloat($("#mixtureT").val())
  if(mixtureT > 1 ){
    $("#mixtureT").val(1.0)
    mixtureT = 1.
  } else if(mixtureT < 0) {
    $("#mixtureT").val(0.0)
    mixtureT = 0.
  }
  drawMixturePdf(parentDivId, mixtureT, mu1, sigma1, mu2, sigma2)
  calculateLogLikelihood(mixtureT, mu1, sigma1, mu2, sigma2)
  
}

function calculateLogLikelihood(t, mu1, sigma1, mu2, sigma2) {
  

    var ll = 0
    var likelihood = 1.0
    for (var i = 0; i < DATA.length; i++) {
      let x = DATA[i]
      let pr_x1 = jStat.normal.pdf(x, mu1, sigma1)
      let pr_x2 = jStat.normal.pdf(x, mu2, sigma2)
      let pr_x = pr_x1 * t + pr_x2 * (1-t)
      ll += Math.log(pr_x)
      likelihood *= pr_x

    }
    $("#likelihood").html(likelihood)
    $("#ll").html(ll.toFixed(1))
    if(best == null || ll > best) {
      best = ll
      $("#best").html(ll.toFixed(1))
    }
}

function drawMixturePdf(parentDivId, t, mu1, sigma1, mu2, sigma2) {
  if(window.myNormalLine) {
    window.myNormalLine.destroy()
  }
  var xValues = []
  var yValues = []



  var min_i = 0
  var max_i = 10
  var step = (max_i - min_i) / 1000
  for (var i = min_i; i <= max_i; i+= step) {
    let pr_x1 = jStat.normal.pdf(i, mu1, sigma1)
    let pr_x2 = jStat.normal.pdf(i, mu2, sigma2)
    let pr_x = pr_x1 * t + pr_x2 * (1-t)
    xValues.push(i.toFixed(3))
    yValues.push(pr_x.toFixed(5))
  }
  let xLabel = 'Values that X can take on'
  let yLabel = 'Probability'
  console.log('tes')

  let dataLines = {}
  for (var i = 0; i < DATA.length; i++) {
    let point = DATA[i]
    let key = 'line' + (i+1)
    let value = {
      type: 'line',
      xMin: Math.round(point*100),
      xMax: Math.round(point*100),
      borderColor: 'rgb(100, 100, 100)',
      borderWidth: 1,
      drawTime: 'beforeDatasetsDraw',
    }
    dataLines[key] = value
  }
  console.log(dataLines)

  var config = {
    type: 'line',
    
    data: {
      labels: xValues,
      datasets: [{
        fill: false,
        backgroundColor: 'blue',
        borderColor: 'blue',
        data: yValues,
        pointRadius:1,
        maxBarThickness:100
      }]
    },
    options: {
      animation: {
            duration: 0
        },
      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      legend: {
              display: false
           },
      plugins: {
        autocolors: false,
        annotation: {
          annotations: dataLines
        },
        legend: {
              display: false
        },
      },
      scales: {
        x: {
          display: true,
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {

          display: true,
          suggestedMax: 0.45,
          title: {
            display: true,
            text: yLabel
          },
          
        }
      }
    }
  }
  var ctx = document.getElementById(parentDivId).getContext('2d');
  window.myNormalLine = new Chart(ctx, config);
}
</script>






<script type="text/javascript">
    // const firebase = require("firebase");
    // Required for side-effects
    // require("firebase/firestore");

    $(document).ready(function () {
        console.log('ready')
        const scrollTop = getScrollTop()
        console.log(scrollTop)
        $("#sidebar").scrollTop(scrollTop)
        $("#sidebar").scroll(function() {
          localStorage.scrollTop = $("#sidebar").scrollTop()
        })
        // $("#sidebar").mCustomScrollbar({
        //     theme: "minimal",
        //     mouseWheel: {preventDefault: true},
        //     advanced:{
        //      autoScrollOnFocus: false,
        //      updateOnContentResize: true
        //     },
        //     scrollInertia:0,
        //     contentTouchScroll:1,
        //     mouseWheel: {
        //         scrollAmount:1000
        //     },
        //     setTop:scrollTop + 'px',
        //     callbacks:{
        //         onScroll:function(){
        //             if(hasStorage) {

        //                 localStorage.scrollTop = this.mcs.top;
        //                 console.log(localStorage.scrollTop)
        //             }
        //         }
        //     } 
        // });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });

        
        let lastPart = getUrlKey()
        
        // Bug: this code will highlight anything which matches with the last part
        $("#sidebar").find('a').each(function(){
            // find link which ends with last part and add style
            let currLink = $($(this)[0]).attr('href')
            let currLastPart = getLastPartOfUrl(currLink)
            if (currLastPart === lastPart) {
                $($(this)[0]).addClass('active-link');
            }
        })
    });

    function getScrollTop() {
        if(typeof(Storage) !== "undefined") {
            return Number(localStorage.scrollTop)
        }
        return 0;
    }

    function getUrlKey() {
        var path = window.location.pathname;
        return getLastPartOfUrl(path)
        
    }

    function getLastPartOfUrl(path) {
        let parts = path.split('/')
        var currIndex = parts.length - 1
        while(currIndex >= 0) {
            let nextPart = parts[currIndex]
            if(nextPart) {
                return nextPart
            }
            currIndex -= 1
        }
        return ''
    }

    function submitQuestion() {
        firebase.initializeApp({
          apiKey: "AIzaSyBqZVV7Qrp0DT3aBCCTCTMUCrPJO0pb3tY",
          authDomain: "probability-digital-world.firebaseapp.com",
          projectId: "probability-digital-world"
        });

        var db = firebase.firestore();

        db.collection("questions").add({
            email: $("#question-email").val(),
            question: "Lovelace",
            page: getUrlKey()
        })
        .then(function(docRef) {
            console.log("Document written with ID: ", docRef.id);
            alert('success')
        })
        .catch(function(error) {
            console.error("Error adding document: ", error);
        });
        // // // Generate a new push ID for the new post
        // var questionListRef = db.child("questions")
        // var newQuestionRef = questionListRef.push();
        // newQuestionRef.set({
        //     'title':'test'
        // });
        
    }

    function onCuriosity() {
        Swal.fire({
          title: 'Curious?',
          position: 'bottom-end',
          allowOutsideClick:false,
          backdrop:false,
          confirmButtonText: 'Submit',
          input: 'textarea',
          html:
            '<p>We are trying to make this book better. Let us know if you find something confusing. If you ask a question we will try to answer it. If you find a mistake we will fix it. </p>' +
            '<input placeholder="Your email (optional)..." id="question-email" class="swal2-input">',
          inputPlaceholder: 'Type your question or message here...',
          inputAttributes: {
            'aria-label': 'Type your question or message here'
          },
          showCancelButton: true,
          preConfirm: () => submitQuestion()
        })
    }
</script>

            <br /><br />

          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    // Calculate and set the viewport height
    function setVh() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    // Initial calculation
    setVh();
    // Recalculate on resize or orientation change
    window.addEventListener('resize', setVh);
    window.addEventListener('orientationchange', setVh);

    document.addEventListener('DOMContentLoaded', function() {
        var sidebarCollapse = document.getElementById('sidebarCollapse');
        var sidebar = document.getElementById('sidebar');

        sidebarCollapse.addEventListener('click', function() {
            // Toggle the 'active' class on the sidebar
            // sidebar.classList.toggle('active');
            // Toggle the 'sidebar-open' class on the body
            document.body.classList.toggle('sidebar-open');
        });
    });
  </script>
  <script>

    $(document).ready(function () {
      //addH2Numbers()
      enableSearch()
    })

    function addH2Numbers() {
      $("h2").each(function (i) {
        let title = $(this).html()
        title = `${i + 1}. ${title}`
        $(this).html(title)
      })
    }

    function enableSearch() {
      $("#probability-for-digital-world-search").on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
          let query = $("#probability-for-digital-world-search").val()

          window.location = `../../search.html?q=${query}`
        }
      });
      // $.ajax({
      //     type: "GET",
      //     url: "../../../searchIndex.json",
      //     dataType: "text",
      //     success: function(data) {addSearchIndexData(data);}
      //  });
    }

    function standardPMFConfig(xValues, yValues, xLabel, yLabel) {
      return {
        type: 'bar',
        data: {
          labels: xValues,
          datasets: [{
            label: 'P(x)',
            fill: false,
            backgroundColor: 'blue',
            borderColor: 'blue',
            data: yValues,
            pointRadius: 1,
            maxBarThickness: 100,
            pointHitRadius: 20
          }]
        },
        options: {

          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }

    function standardPDFConfig(xValues, yValues, xLabel, yLabel) {
      return {
        type: 'line',
        data: {
          labels: xValues,
          datasets: [{
            label: 'f(x)',
            fill: false,
            backgroundColor: 'blue',
            borderColor: 'blue',
            data: yValues,
            pointRadius: 1,
            maxBarThickness: 100,
            pointHitRadius: 20
          }]
        },
        options: {
          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }

    function standardPDFsConfig(datasets, xValues, xLabel, yLabel) {
      return {
        type: 'line',
        data: {
          datasets: datasets
        },
        options: {

          steppedLine: false,
          responsive: true,
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          animation: {
            duration: 0
          },
          plugins: {
            legend: {
              display: false
            },
          },
          scales: {
            x: {
              display: true,
              type: 'linear',
              title: {
                display: true,
                text: xLabel
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yLabel
              },
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      };
    }


    function addSearchIndexData(data) {
      var idx = lunr(function () {
        this.ref('name')
        this.field('text')

        let documents = JSON.parse(data)

        documents.forEach(function (doc) {
          this.add(doc)
        }, this)

        $("#probability-for-digital-world-search").on('keyup', function (e) {
          if (e.key === 'Enter' || e.keyCode === 13) {
            let query = $("#probability-for-digital-world-search").val()
            let results = idx.search(query)
          }
        });
      })
    }

  </script>

</body>




</html>