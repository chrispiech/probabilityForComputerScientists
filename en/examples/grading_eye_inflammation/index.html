
<!DOCTYPE html>
<html>

<head>
    

<title>Grading Eye Inflamation</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="content-type" content="text/html; charset=UTF8">

<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
 <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />

<!-- D3 CDN -->
<script src="https://d3js.org/d3.v3.js"></script>
<!-- <script src="https://d3js.org/d3.v4.js"></script> -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- Chart CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js" integrity="sha512-FuXN8O36qmtA+vRJyRoAxPcThh/1KJJp7WSRnjCpqA+13HYGrSWiyzrCHalCWi42L5qH1jt88lX5wy5JyFxhfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- PDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js" integrity="sha512-Z8CqofpIcnJN80feS2uccz+pXWgZzeKxDsDNMD/dJ6997/LSRY+W4NmEt9acwR+Gt9OHN0kkI1CTianCwoqcjQ==" crossorigin="anonymous"></script>

<!-- Lunr CDN -->
 <script src="https://unpkg.com/lunr@2.0.4/lunr.js"></script>

<!-- Firebase CDN -->
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="../../../css/style.css">

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>


   

<!-- Java Script -->
<script src="../../../plugins/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Python highlighting -->
<script src="../../../plugins/prism/prism.js"></script>
<link href="../../../plugins/prism/prism.css" rel="stylesheet" />

<!-- Probability Packages -->
<script src="../../../js/probabilityUtils.js"></script>
<script src="../../../plugins/probability/gaussian.js"></script>
<script src="../../../plugins/color.js"></script>
<script src='https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js'></script>


<!-- font awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<!-- SWAL -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<!-- Stanford -->
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,600,700' rel='stylesheet' type='text/css'>
<link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">

<!-- Math Jax -->
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script> -->
<script type="text/javascript">
  MathJax = {
    config: ["MMLorHTML.js"],
    jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
    extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js"],
    TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js", "action.js"]
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
	"fast-preview": {
	  disabled: true
	}
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>



<script src="../../../plugins/math.min.js"></script>



    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

 <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="../../../plugins/jquery.mCustomScrollbar.js"></script>

</head>

<script>
  Chart.defaults.font.family = 'Times New Roman';
  Chart.defaults.font.size = 18;
</script>


<!-- I declare a few math operators I often use in equations -->
<div style="display:none">
  $\DeclareMathOperator{\p}{P}$
  $\DeclareMathOperator{\P}{P}$
  $\DeclareMathOperator{\c}{^C}$
  $\DeclareMathOperator{\or}{  or}$
  $\DeclareMathOperator{\and}{  and}$
  $\DeclareMathOperator{\var}{Var}$
  $\DeclareMathOperator{\Var}{Var}$
  $\DeclareMathOperator{\Std}{Std}$
  $\DeclareMathOperator{\E}{E}$
  $\DeclareMathOperator{\std}{Std}$
  $\DeclareMathOperator{\Ber}{Bern}$
  $\DeclareMathOperator{\Bin}{Bin}$
  $\DeclareMathOperator{\Poi}{Poi}$
  $\DeclareMathOperator{\Uni}{Uni}$
  $\DeclareMathOperator{\Geo}{Geo}$
  $\DeclareMathOperator{\NegBin}{NegBin}$
  $\DeclareMathOperator{\Beta}{Beta}$
  $\DeclareMathOperator{\Exp}{Exp}$
  $\DeclareMathOperator{\N}{N}$
  $\DeclareMathOperator{\R}{\mathbb{R}}$
  $\DeclareMathOperator*{\argmax}{arg\,max}$
  $\newcommand{\d}{\, d}$
  
</div>

<body class="greyBackground">


    <div class="wrapper">
        <!-- Sidebar  -->
<nav id="sidebar">
    <div class="sidebar-header">
        <!-- <div></div> -->
        <a style="text-align:left" href="../../index.html"><h3></i> Probability<br/>For Computer Science<br/></h3></a>
    </div>

    <div> 
        <!-- Put a link back to cs109 -->
    

        <!-- This adds a search bar! -->
        <div class="searchCol" style="font-family: 'Source Sans Pro', sans-serif;">
            
            <input type="text" class="form-control bookSearch" id="probability-for-digital-world-search" aria-describedby="search box" placeholder="🔍 Search book..."/>
        </div>
        
    </div>

<!-- intro -->
<ul class="list-unstyled components">
<li>
<a id=sidebar-notation href="../../intro/notation">Notation Reference</a>
<a id=sidebar-core_probability_ref href="../../intro/core_probability_ref">Core Probability Reference</a>
<a id=sidebar-all_distributions href="../../intro/all_distributions">Random Variable Reference</a>
<a id=sidebar-python href="../../intro/python">Python Reference</a>
<a id=sidebar-calculators href="../../intro/calculators">Calculators</a>
</li>
</ul>

<!-- part1 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part1">Part 1: Core Probability</p></li>
<li>
<a id=sidebar-counting href="../../part1/counting">Counting</a>
<a id=sidebar-combinatorics href="../../part1/combinatorics">Combinatorics</a>
<a id=sidebar-probability href="../../part1/probability">Definition of Probability</a>
<a id=sidebar-equally_likely href="../../part1/equally_likely">Equally Likely Outcomes</a>
<a id=sidebar-prob_or href="../../part1/prob_or">Probability of <b>or</b></a>
<a id=sidebar-cond_prob href="../../part1/cond_prob">Conditional Probability</a>
<a id=sidebar-independence href="../../part1/independence">Independence</a>
<a id=sidebar-prob_and href="../../part1/prob_and">Probability of <b>and</b></a>
<a id=sidebar-law_total href="../../part1/law_total">Law of Total Probability</a>
<a id=sidebar-bayes_theorem href="../../part1/bayes_theorem">Bayes' Theorem</a>
<a id=sidebar-log_probabilities href="../../part1/log_probabilities">Log Probabilities</a>
<a id=sidebar-many_flips href="../../part1/many_flips">Many Coin Flips</a>

<li>
    <a href="#part1_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part1_examples">
        <li><a href="../../examples/enigma">Enigma Machine</a></li><li><a href="../../examples/serendipity">Serendipity</a></li><li><a href="../../examples/random_shuffles">Random Shuffles</a></li><li><a href="../../examples/counting_graphs">Random Graphs</a></li><li><a href="../../examples/diversity_shapes">Set Diversity</a></li><li><a href="../../examples/bacteria_evolution">Bacteria Evolution</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part2 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part2">Part 2: Random Variables</p></li>
<li>
<a id=sidebar-rvs href="../../part2/rvs">Random Variables</a>
<a id=sidebar-pmf href="../../part2/pmf">Probability Mass Functions</a>
<a id=sidebar-expectation href="../../part2/expectation">Expectation</a>
<a id=sidebar-variance href="../../part2/variance">Variance</a>
<a id=sidebar-bernoulli href="../../part2/bernoulli">Bernoulli Distribution</a>
<a id=sidebar-binomial href="../../part2/binomial">Binomial Distribution</a>
<a id=sidebar-poisson href="../../part2/poisson">Poisson Distribution</a>
<a id=sidebar-more_discrete href="../../part2/more_discrete">More Discrete Distributions</a>
<a id=sidebar-categorical href="../../part2/categorical">Categorical Distributions</a>
<a id=sidebar-continuous href="../../part2/continuous">Continuous Distribution</a>
<a id=sidebar-uniform href="../../part2/uniform">Uniform Distribution</a>
<a id=sidebar-exponential href="../../part2/exponential">Exponential Distribution</a>
<a id=sidebar-normal href="../../part2/normal">Normal Distribution</a>
<a id=sidebar-binomial_approx href="../../part2/binomial_approx">Binomial Approximation</a>

<li>
    <a href="#part2_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part2_examples">
        <li><a href="../../examples/100_binomial_problems">100 Binomial Problems</a></li><li><a href="../../examples/winning_series">Winning Series</a></li><li><a href="../../examples/approximate_counting">Approximate Counting</a></li><li><a href="../../examples/jury">Jury Selection</a></li><li><a href="../../examples/grading_eye_inflammation">Grading Eye Inflamation</a></li><li><a href="../../examples/grades_not_normal">Grades are Not Normal</a></li><li><a href="../../examples/curse_of_dimensionality">Curse of Dimensionality</a></li><li><a href="../../examples/algorithmic_art">Algorithmic Art</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part3 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part3">Part 3: Probabilistic Models</p></li>
<li>
<a id=sidebar-joint href="../../part3/joint">Joint Probability</a>
<a id=sidebar-marginalization href="../../part3/marginalization">Marginalization</a>
<a id=sidebar-multinomial href="../../part3/multinomial">Multinomial</a>
<a id=sidebar-continuous_joint href="../../part3/continuous_joint">Continuous Joint</a>
<a id=sidebar-inference href="../../part3/inference">Inference</a>
<a id=sidebar-bayesian_networks href="../../part3/bayesian_networks">Bayesian Networks</a>
<a id=sidebar-independent_vars href="../../part3/independent_vars">Independence in Variables</a>
<a id=sidebar-correlation href="../../part3/correlation">Correlation</a>
<a id=sidebar-computational_inference href="../../part3/computational_inference">General Inference</a>

<li>
    <a href="#part3_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part3_examples">
        <li><a href="../../examples/fairness">Fairness in AI</a></li><li><a href="../../examples/federalist">Federalist Paper Authorship</a></li><li><a href="../../examples/name2age">Name to Age</a></li><li><a href="../../examples/prob_baby_delivery">Probability of Baby Delivery</a></li><li><a href="../../examples/bayesian_carbon_dating">Bayesian Carbon Dating</a></li><li><a href="../../examples/digital_vision_test">Digital Vision Test</a></li><li><a href="../../examples/bridge_distribution">Bridge Distribution</a></li><li><a href="../../examples/bayesian_viral_load_test">Bayesian Viral Load Test</a></li><li><a href="../../examples/dart_logo">CS109 Logo</a></li><li><a href="../../examples/tracking_in_2D">Tracking in 2D</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part4 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part4">Part 4: Uncertainty Theory</p></li>
<li>
<a id=sidebar-beta href="../../part4/beta">Beta Distribution</a>
<a id=sidebar-summation_vars href="../../part4/summation_vars">Adding Random Variables</a>
<a id=sidebar-clt href="../../part4/clt">Central Limit Theorem</a>
<a id=sidebar-samples href="../../part4/samples">Sampling</a>
<a id=sidebar-bootstrapping href="../../part4/bootstrapping">Bootstrapping</a>
<a id=sidebar-algorithmic_analysis href="../../part4/algorithmic_analysis">Algorithmic Analysis</a>
<a id=sidebar-information_theory href="../../part4/information_theory">Information Theory</a>
<a id=sidebar-divergence href="../../part4/divergence">Distance Between Distributions</a>

<li>
    <a href="#part4_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part4_examples">
        <li><a href="../../examples/thompson">Thompson Sampling</a></li><li><a href="../../examples/night_sight">Night Sight</a></li><li><a href="../../examples/p_hacking">P-Hacking</a></li><li><a href="../../examples/differential_privacy">Differential Privacy</a></li>
    </ul>
</li>
</li>
</ul>

<!-- part5 -->
<ul class="list-unstyled components">
<li><p href="{pathToLang}part5">Part 5: Machine Learning</p></li>
<li>
<a id=sidebar-parameter_estimation href="../../part5/parameter_estimation">Parameter Estimation</a>
<a id=sidebar-mle href="../../part5/mle">Maximum Likelihood Estimation</a>
<a id=sidebar-map href="../../part5/map">Maximum A Posteriori</a>
<a id=sidebar-machine_learning href="../../part5/machine_learning">Machine Learning</a>
<a id=sidebar-naive_bayes href="../../part5/naive_bayes">Naïve Bayes</a>
<a id=sidebar-log_regression href="../../part5/log_regression">Logistic Regression</a>

<li>
    <a href="#part5_examples" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle show">Applications</a>
    <ul class="collapse list-unstyled show" id="part5_examples">
        <li><a href="../../examples/mle_demo">MLE Normal Demo</a></li><li><a href="../../examples/mle_pareto">MLE Pareto Distribution</a></li><li><a href="../../examples/mixture_models">MLE Mixture Model</a></li>
    </ul>
</li>
</li>
</ul>



    <!-- <ul class="list-unstyled components">
        
         <li>
            <p>Part ?: Misfits</p>
        </li>
        <li>
             <a href="../../examples/probBabies.html">Probability and babies</a>
            
             <a href="../../">Sampling from a likelihood function</a>
             <a href="../../">Law of Total Expectation</a>
            
        </li>
    </ul> -->



    <ul class="list-unstyled CTAs">
        <li>
            Ⓒ Chris Piech, Stanford University
            <!-- <a href="https://compedu.stanford.edu/codeinplace/v1/#/course" class="download">Back to Code in Place</a> -->
        </li>
    </ul>
</nav>
        <!-- Page Content  -->
        <div id="content">

<button type="button" id="sidebarCollapse" class="mobile-only btn btn-dark exclude-from-print">
    <i class="fas fa-align-left"></i>
    <span></span>
</button>
            <!-- <button id="curiosityButton" onclick = "onCuriosity()" type="button" class="btn btn-primary btn-sm">
              <span style="font-size:150%">I'm Curious</span>
              <span></span>
          </button> -->
            
            <div class="container-fluid">
                <div class="row d-flex justify-content-center">
                    <div class="col handout" >
              
                        
 
<center><h1>Grading Eye Inflammation</h1></center>
<hr/>

<p>When a patient has eye inflammation, eye doctors "grade" the inflammation. When "grading" inflammation they randomly look at a single 1 millimeter by 1 millimeter square in the patient's eye and count how many "cells" they see. 

<p>There is uncertainty in these counts. If the true average number of cells for a given patient's eye is 6, the doctor could get a different count (say 4, or 5, or 7) just by chance. As of 2021, modern eye medicine does not have a sense of uncertainty for their inflammation grades! In this problem we are going to change that. At the same time we are going to learn about Poisson distributions over space.

<center>
	<img class="mainFigureLg" src="../../../img/chapters/gradingInflammation/eye.png"></img>
</center>

<p>Why is the number of cells observed in a 1x1 square governed by a Poisson process?

        <p>We can approximate a distribution for the count by discretizing the square into a fixed number of equal sized buckets. Each bucket either has a cell or not. Therefore, the count of cells in the 1x1 square is a sum of Bernoulli random variables with equal $p$, and as such can be modeled as a binomial random variable. This is an approximation because it doesn't allow for two cells in one bucket. Just like with time, if we make the size of each bucket infinitely small, this limitation goes away and we converge on the true distribution of counts. The binomial in the limit, i.e. a binomial as $n \rightarrow \infty$, is truly represented by a Poisson random variable. In this context, $\lambda$ represents the average number of cells per 1$\times$1  sample. See Figure 2.
    
  
  <p><center>
	<img class="mainFigureFull" src="../../../img/chapters/gradingInflammation/poissoneye.png"></img>
</center></p>  
   

<p> For a given patient the true average rate of cells is 5 cells per 1x1 sample. What is the probability that in a single 1x1 sample the doctor counts 4 cells?</p>

<p><div class="bordered">

    Let $X$ denote the number of cells in the 1x1 sample. We note that $X \sim \Poi(5)$. We want to find $P(X=4)$.
    \[P(X=4) = \frac{5^4 e^{-5}}{4!} \approx 0.175\]

   
</div></p>


    


<hr/>

<h3>Multiple Observations</h3>

<p><div class="alert alert-primary"><b>Heads up!</b> This section uses concepts from Part 3. Specifically <a href="../../part3/independent_vars">Independence in Variables</a></div></p>

<p> For a given patient the true average rate of cells is 5 cells per 1mm by 1mm sample. In an attempt to be more precise, the doctor counts cells in <b>two</b> different, larger <b>2mm by 2mm</b> samples. Assume that the occurrences of cells in one 2mm by 2mm samples are independent of the occurrences in any other 2mm by 2mm samples. What is the probability that she counts 20 cells in the first samples and 20 cells in the second?

<div class="bordered">
Let $Y_1$ and $Y_2$ denote the number of cells in each of the 2x2 samples. Since there are 5 cells in a 1x1 sample, there are 20 samples in a 2x2 sample since the area quadrupled, so we have that $Y_1 \sim \Poi(20)$ and $Y_2 \sim \Poi(20)$. We want to find $P(Y_1 = 20 \land Y_2 = 20)$. Since the number of cells in the two samples are independent, this is equivalent to finding $\P(Y_1 = 20) \P(Y_2=20)$.
</div>



<h3>Estimating Lambda</h3>

<p><div class="alert alert-primary"><b>Heads up!</b> This section uses concepts from Part 5. Specifically <a href="../../part5/map">Maximum A Posteriori</a></div></p>

<p><div class="purpleBox">
<b>Inflammation prior</b>: Based on millions of historical patients, doctors have learned that the prior probability density function of true rate of cells is:
\begin{align*}
    f(\lambda) = K \cdot \lambda \cdot e ^{-\frac{\lambda}{2}}
\end{align*}
Where $K$ is a normalization constant and $\lambda$ must be greater than 0.
</div></p>

<p> A doctor takes a single sample and counts 4 cells. Give an equation for the updated probability density of $\lambda$. Use the "Inflammation prior" as the prior probability density over values of $\lambda$. Your probability density may have a constant term.</p>

	<p><div class="bordered">

    
    Let $\theta$ be the random variable for true rate. Let $X$ be the random variable for the count
    \begin{align*}
        f(\theta = \lambda | X = 4)  
        &= \frac{P(X=4|\theta = \lambda) f(\theta = \lambda)}{P(X = 4)} \\
        &= \frac{\frac{\lambda^{4} e^{-\lambda}}{4!} \cdot K \cdot \lambda \cdot e^{\lambda / 2}}{P(X = 4)} \\
        &= \frac{K \cdot \lambda^5 e^{-\frac{3}{2}\lambda}}{4! P(X=4)}
     \end{align*}
      </div></p>

   <p>A doctor takes a single  sample and counts 4 cells. What is the <a href="../../part5/map">Maximum A Posteriori</a> estimate of $\lambda$?</p>

<p><div class="bordered">
    
    Maximize the "posterior" of the parameter calculated in the previous section:
    \begin{align*}
        \argmax_\limits\lambda \frac{K \cdot \lambda^5 e^{-\frac{3}{2}\lambda}}{4! P(X=4)}
            &= \argmax_\limits\lambda \lambda^5 e^{-\frac{3}{2}\lambda}  \\
    \end{align*}
    
    Take logarithm (preserves argmax, and easier derivative):
    \begin{align*}
        &= \argmax_\limits\lambda \log \left(\lambda^5 e^{-\frac{3}{2}\lambda} \right) \\
        &= \argmax_\limits\lambda \left(5 \log \lambda -\frac{3}{2}\lambda\right)
    \end{align*}

    Calculate the derivative with respect to the parameter, and set equal to 0
    \begin{align*}
        0 &= \frac{\partial}{\partial \lambda} \left(5 \log \lambda -\frac{3}{2}\lambda\right) \\
        0 &= \frac{5}{\lambda} -\frac{3}{2} \\
        \lambda &= \frac{10}{3}
    \end{align*}
 </div></p>

<p>Explain, in words, the difference between the two estimates of lambda in the two previous parts. </p>

<p><div class="bordered">
	The estimate in the first part is a ``distribution" (also called a soft estimate) whereas the estimate in the second part is a single value (also called a point estimate). The former contains information about confidence.
</div></p>

What is the MLE estimate of $\lambda$?

<p><div class="bordered">
    The MLE estimate doesn't use the prior belief. The MLE estimate for a poisson is simply the average of the observations. In this case the average of our single observation is 4. MLE is not a great tool for estimating our parameter from just one datapoint.
</div></p>

<p>A patient comes on two separate days. The first day the doctor counts 5 cells, the second day the doctor counts 4 cells. Based only on this observation, and treating the true rates on the two days as independent, what is the probability that the patient's inflammation has gotten better (in other words, that their $\lambda$ has decreased)? </p>

<p><div class="bordered">
	Let $\theta_1$ be the random variable for lambda on the first day and $\theta_2$ be the random variable for lambda on the second day.

\begin{align*}
     f(\theta_1 = \lambda | X = 5) &= K_1 \cdot \lambda^6 e^{-\frac{3}{2}\lambda}  \\
     f(\theta_2 = \lambda | X = 4) &= K_2 \cdot \lambda^5 e^{-\frac{3}{2}\lambda} 
\end{align*}

The question is asking what is $P(\theta_1 > \theta_2)$? There are a few ways to calculate this exactly:
\begin{align*}
& \int_{\lambda_1=0}^\infty \int_{\lambda_2=0}^{\lambda_1} f(\theta_1 = \lambda_1, \theta_2 = \lambda_2) \\
&= \int_{\lambda_1=0}^\infty \int_{\lambda_2=0}^{\lambda_1} f(\theta_1 = \lambda_1) \cdot f(\theta_2 = \lambda_2) \\
&= \int_{\lambda_1=0}^\infty f(\theta_1 = \lambda_1) \int_{\lambda_2=0}^{\lambda_1}   f(\theta_2 = \lambda_2) \\
&= \int_{\lambda_1=0}^\infty K_1 \cdot \lambda^6 e^{-\frac{3}{2}\lambda} \int_{\lambda_2=0}^{\lambda_1}   K_2 \cdot \lambda^5 e^{-\frac{3}{2}\lambda}
\end{align*}</div>




                        



<script type="text/javascript">
    // const firebase = require("firebase");
    // Required for side-effects
    // require("firebase/firestore");

    $(document).ready(function () {
        console.log('ready')
        const scrollTop = getScrollTop()
        console.log(scrollTop)
        $("#sidebar").scrollTop(scrollTop)
        $("#sidebar").scroll(function() {
          localStorage.scrollTop = $("#sidebar").scrollTop()
        })
        // $("#sidebar").mCustomScrollbar({
        //     theme: "minimal",
        //     mouseWheel: {preventDefault: true},
        //     advanced:{
        //      autoScrollOnFocus: false,
        //      updateOnContentResize: true
        //     },
        //     scrollInertia:0,
        //     contentTouchScroll:1,
        //     mouseWheel: {
        //         scrollAmount:1000
        //     },
        //     setTop:scrollTop + 'px',
        //     callbacks:{
        //         onScroll:function(){
        //             if(hasStorage) {

        //                 localStorage.scrollTop = this.mcs.top;
        //                 console.log(localStorage.scrollTop)
        //             }
        //         }
        //     } 
        // });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });

        
        let lastPart = getUrlKey()
        
        // Bug: this code will highlight anything which matches with the last part
        $("#sidebar").find('a').each(function(){
            // find link which ends with last part and add style
            let currLink = $($(this)[0]).attr('href')
            let currLastPart = getLastPartOfUrl(currLink)
            if (currLastPart === lastPart) {
                $($(this)[0]).addClass('active-link');
            }
        })
    });

    function getScrollTop() {
        if(typeof(Storage) !== "undefined") {
            return Number(localStorage.scrollTop)
        }
        return 0;
    }

    function getUrlKey() {
        var path = window.location.pathname;
        return getLastPartOfUrl(path)
        
    }

    function getLastPartOfUrl(path) {
        let parts = path.split('/')
        var currIndex = parts.length - 1
        while(currIndex >= 0) {
            let nextPart = parts[currIndex]
            if(nextPart) {
                return nextPart
            }
            currIndex -= 1
        }
        return ''
    }

    function submitQuestion() {
        firebase.initializeApp({
          apiKey: "AIzaSyBqZVV7Qrp0DT3aBCCTCTMUCrPJO0pb3tY",
          authDomain: "probability-digital-world.firebaseapp.com",
          projectId: "probability-digital-world"
        });

        var db = firebase.firestore();

        db.collection("questions").add({
            email: $("#question-email").val(),
            question: "Lovelace",
            page: getUrlKey()
        })
        .then(function(docRef) {
            console.log("Document written with ID: ", docRef.id);
            alert('success')
        })
        .catch(function(error) {
            console.error("Error adding document: ", error);
        });
        // // // Generate a new push ID for the new post
        // var questionListRef = db.child("questions")
        // var newQuestionRef = questionListRef.push();
        // newQuestionRef.set({
        //     'title':'test'
        // });
        
    }

    function onCuriosity() {
        Swal.fire({
          title: 'Curious?',
          position: 'bottom-end',
          allowOutsideClick:false,
          backdrop:false,
          confirmButtonText: 'Submit',
          input: 'textarea',
          html:
            '<p>We are trying to make this book better. Let us know if you find something confusing. If you ask a question we will try to answer it. If you find a mistake we will fix it. </p>' +
            '<input placeholder="Your email (optional)..." id="question-email" class="swal2-input">',
          inputPlaceholder: 'Type your question or message here...',
          inputAttributes: {
            'aria-label': 'Type your question or message here'
          },
          showCancelButton: true,
          preConfirm: () => submitQuestion()
        })
    }
</script>

                         <br/><br/>
                
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

$(document).ready(function() {
  //addH2Numbers()
  enableSearch()
})

function addH2Numbers() {
  $("h2").each(function(i){
    let title = $(this).html()
    title = `${i+1}. ${title}`
    $(this).html(title)
  })
}

function enableSearch() {
  $("#probability-for-digital-world-search").on('keyup', function (e) {
      if (e.key === 'Enter' || e.keyCode === 13) {
          let query = $("#probability-for-digital-world-search").val()
          
          window.location = `../../search.html?q=${query}`
      }
  });
  // $.ajax({
  //     type: "GET",
  //     url: "../../../searchIndex.json",
  //     dataType: "text",
  //     success: function(data) {addSearchIndexData(data);}
  //  });
}

function standardPMFConfig(xValues, yValues, xLabel, yLabel){
  return {
    type: 'bar',
    data: {
      labels: xValues,
      datasets: [{
        label: 'P(x)',
        fill: false,
        backgroundColor: 'blue',
        borderColor: 'blue',
        data: yValues,
        pointRadius:1,
        maxBarThickness:100,
        pointHitRadius: 20
      }]
    },
    options: {

      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}

function standardPDFConfig(xValues, yValues, xLabel, yLabel){
  return {
    type: 'line',
    data: {
      labels: xValues,
      datasets: [{
        label: 'f(x)',
        fill: false,
        backgroundColor: 'blue',
        borderColor: 'blue',
        data: yValues,
        pointRadius:1,
        maxBarThickness:100,
        pointHitRadius: 20
      }]
    },
    options: {
      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}

function standardPDFsConfig(datasets, xValues, xLabel, yLabel){
  return {
    type: 'line',
    data: {
      datasets: datasets
    },
    options: {

      steppedLine: false,
      responsive: true,
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      animation: {
            duration: 0
        },
      plugins: {
        legend: {
              display: false
           },
         },
      scales: {
        x: {
          display: true,
          type: 'linear',
          title: {
            display: true,
            text: xLabel
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: yLabel
          },
          ticks: {
            beginAtZero: true
          }
        }
      }
    }
  };
}


function addSearchIndexData(data) {
  var idx = lunr(function () {
    this.ref('name')
    this.field('text')

    let documents = JSON.parse(data)

    documents.forEach(function (doc) {
      this.add(doc)
    }, this)

    $("#probability-for-digital-world-search").on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            let query = $("#probability-for-digital-world-search").val()
            let results = idx.search(query)
        }
    });
  })
}

    </script>

</body>




</html>